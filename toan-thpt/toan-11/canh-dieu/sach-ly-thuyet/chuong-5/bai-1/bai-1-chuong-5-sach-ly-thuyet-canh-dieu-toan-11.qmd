---
title: "Bài 1. Các số đặc trưng đo xu thế trung tâm cho mẫu số liệu ghép nhóm"
subtitle: "Chương 5 | Cánh Diều | Toán 11"
author: "ZO | `r Sys.Date()`"

lang: vi

format:
    html:
        theme: flatly
        css: custom.css
        toc: true
    pdf:
        pdf-engine: lualatex
        include-in-header: custom.tex
        keep-tex: true
    #markdown:
        # prefer-html: false # true # Ưu tiên HTML gốc

execute:
    # Bật bộ nhớ đệm cho các khối mã trong tài liệu.
    # Khi tài liệu được biên dịch lại, nếu một khối mã không thay đổi, Quarto sẽ sử dụng kết quả cũ
    # thay vì chạy lại từ đầu. Điều này giúp tiết kiệm thời gian khi làm việc với dữ liệu lớn hoặc mã phức tạp.
    cache: true

filters:
    - custom-filters.lua
---

```{r setup, include=FALSE}
library(knitr)
library(kableExtra)
library(dplyr)
library(MASS)
# library(ggplot2)
```

::: {.alert .alert-info} 
Đây là Bài 1: *Các số đặc trưng đo xu thế trung tâm cho mẫu số liệu ghép nhóm*, Chương V: *Một số yếu tố thống kê và xác suất*, bộ *Cánh Diều*, Toán 11 (trang 14, tập 2).
:::

<!-- HOẠT ĐỘNG 1 -->

<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Hoạt động 1</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Hoạt động 1}
:::

Trong *Bảng 1*, ta thấy:

- Có 13 ô-tô có độ tuổi dưới 4;
- Có 29 ô-tô có độ tuổi từ 4 đến dưới 8.

Hãy xác định số ô-tô có độ tuổi:

- Từ 8 đến dưới 12;
- Từ 12 đến dưới 16;
- Từ 16 đến dưới 20.

<!-- KHUNG DỮ LIỆU -->
```{r, echo = FALSE}
hd1 <- new.env()
hd1$df <- data.frame(
    ` ` = c(1, 2, 3, 4, 5),
    `Nhóm` = c("\\([0;4)\\)", "\\([4;8)\\)", "\\([8;12)\\)", "\\([12;16)\\)", "\\([16;20)\\)"),
    `Mút trái` = seq(0, 16, by = 4),
    `Mút phải` = seq(4, 20, by = 4),
    `Giá trị đại diện` = .5 * (seq(0, 16, by = 4) + seq(4, 20, by = 4)),
    `Tần số` = c(13, 29, 48, 22, 8),
    `Tần số tích lũy` = cumsum(c(13, 29, 48, 22, 8)),
    check.names = FALSE
)
data <- data.frame(hd1$df[, c(-1, -3, -4, -5, -7), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "\\(n=120\\)"))
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA, caption = "Bảng 1") %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

</details>

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

::: {.callout-tip title="Mẹo" collapse="true"}
Bạn có biết? Khi chưa quen với cách lập luận, bắt chước sách giáo khoa là một cách tốt để làm quen với cách trình bày. Khi đã hiểu rõ, bạn có thể tự phát triển cách lập luận của riêng mình.
:::

Nội dung *Bảng 1*:

- **Nhóm**: Mỗi nhóm là một khoảng tuổi ô-tô.
- **Tần số**: Số lượng ô-tô thuộc nhóm đó.

Câu trả lời bắt chước theo sách giáo khoa :

- Có 48 ô-tô có độ tuổi từ 8 đến dưới 12.
- Có 22 ô-tô có độ tuổi từ 12 đến dưới 16.
- Có 8 ô-tô có độ tuổi từ 16 đến dưới 20.

::: {.callout-caution collapse="true" title="Suy nghĩ sâu hơn"}
Nhìn vào bảng số liệu, bạn có nhận xét gì về số lượng ô-tô theo từng nhóm độ tuổi?

- Số lượng ô-tô cũ (trên 12 năm) có ít hơn xe mới không?
- Điều này có ý nghĩa gì?
:::

</details>

<!-- LUYỆN TẬP - VẬN DỤNG 1 -->
<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Luyện tập - vận dụng 1</summary>
:::

:::{.content-visible when-format="pdf"}
\section*{Luyện tập - vận dụng 1}
:::

Mẫu số liệu ghép nhóm ở *Bảng 1* có bao nhiêu số liệu? Bao nhiêu nhóm? Tìm tần số của mỗi nhóm.
```{r, echo = FALSE}
data <- data.frame(hd1$df[, c(-1, -3, -4, -5, -7), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "\\(n=120\\)"))
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA, caption = "Bảng 1") %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

</details>

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải</summary>
:::

:::{.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

Mẫu số liệu ghép nhóm ờ *Bảng 1* có 120 số liệu. Có 5 nhóm. Tần số của các nhóm 1, 2, 3, 4, 5 lần lượt là 13, 29, 48, 22, 8.
</details>

<!-- HOẠT ĐỘNG 2 -->
Một trường trung học phổ thông chọn 36 học sinh nam của khối lớp 11, đo chiều cao của các bạn học sinh đó và thu được mẫu số liệu sau (đơn vị: cm):
<!-- DỮ LIỆU -->
```{r, echo = FALSE}
hd2 <- new.env()
# Tạo dữ liệu
hd2$data <- c(160, 161, 161, 162, 162, 162, 163, 163, 163, 164, 164, 164, 164, 165, 165, 165, 165, 165, 166, 166, 166, 166, 167, 167, 168, 168, 168, 168, 169, 169, 170, 171, 171, 172, 172, 174)
data <- matrix(hd2$data, nrow = 3, byrow = TRUE)
# Định dạng số thập phân: thay dấu "." bằng ","
data <- format(data, decimal.mark = ",")
# Bảng
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA) %>%
        kable_styling(latex_options = "hold_position")
}
```

Từ mẫu số liệu không ghép nhóm trên, hãy ghép các số liệu thành năm nhóm theo các nửa khoảng có độ dài bằng nhau.

<!-- LỜI GIẢI HOẠT ĐỘNG 2 -->
::: {.callout-tip title="Mẹo" collapse="true"}
Sắp xếp số liệu theo thứ tự tăng dần giúp mình dễ phân nhóm hơn.
:::
Số liệu nhỏ nhất là 160, số liệu lớn nhất là 174. Mình cần chia thành 5 nhóm có độ dài bằng nhau, nên độ dài mỗi nhóm là
$$
\frac{174-160}{5}=2,8.
$$
Nhưng nếu chia nhóm theo độ dài 2,8 cm, mình sẽ gặp các ranh giới không đẹp: 

::: {.center}
$[160;162,8)$, $[162,8;165.6)$, $[165,6;168,4)$, $[168,4;171,2)$, $[171,2;174]$.
:::

Rõ ràng, các số thập phân như 2,8; 162,8; 165,6 vâng vâng, rất khó đọc, khó vẽ biểu đồ và không phù hợp với cách làm thống kê trong thực tế.

Số 3 là số nguyên nhỏ nhất gần với 2,8. Nếu mình chọn độ dài nhóm là 3, miền dữ liệu cần mở rộng ra một chút để bao phủ toàn bộ dữ liệu cũ. Lúc này, nếu vẫn giữ đầu dưới là 160, thì đầu trên là
$$
160+5\cdot 3 = 175.
$$
Khi đó, các nhóm mới là 

::: {.center}
$[160;3)$, $[163;166)$, $[166;169)$, $[169;172)$, $[172;175)$.
:::

Nhóm cuối mình ghi là nửa khoảng, $[172; 175)$, vì 175 không có trong số liệu gốc.


<!-- LUYỆN TẬP - VẬN DỤNG 2 -->

<!-- LỜI GIẢI LUYỆN TẬP - VẬN DỤNG 2 -->

<!-- HOẠT ĐỘNG 3 -->

<!-- LỜI GIẢI HOẠT ĐỘNG 3 -->


<!-- LUYỆN TẬP - VẬN DỤNG 3 -->

<!-- LỜI GIẢI LUYỆN TẬP - VẬN DỤNG 2 -->

<!-- HOẠT ĐỘNG 4 -->

<!-- LỜI GIẢI HOẠT ĐỘNG 4 -->

<!-- LUYỆN TẬP - VẬN DỤNG 4 -->

<!-- LỜI GIẢI LUYỆN TẬP - VẬN DỤNG 4 -->

<!-- BÀI TẬP 1 -->
<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Bài tập 1</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Bài tập 1}
:::

Mẫu số liệu dưới đây ghi lại tốc độ của 40 ô-tô khi đi qua một trạm đo tốc độ (đơn vị: km/h):

<!-- DỮ LIỆU -->
```{r, echo = FALSE}
bai1 <- new.env()
# Tạo dữ liệu
bai1$data <- c(48.5, 43, 50, 55, 45, 60, 53, 55.5, 44, 65, 51, 62.5, 41, 44.5, 57, 57, 68, 49, 46.5, 53.5, 61, 49.5, 54, 62, 59, 56, 47, 50, 60, 61, 49.5, 52.5, 57, 47, 60, 55, 45, 47.5, 48, 61.5)
data <- matrix(bai1$data, nrow = 4, byrow = TRUE)
# Định dạng số thập phân: thay dấu "." bằng ","
data <- format(data, decimal.mark = ",")
# Bảng
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA) %>%
        kable_styling(latex_options = "hold_position")
}
```

a. Lập bảng tần số ghép nhóm cho mẫu số liệu trên có sáu nhóm ứng với sáu nửa khoảng:

::: {.content-visible when-format="html"}
<div style="text-align: center;">
$[40; 45)$, $[45 ; 50)$, $[50; 55)$, $[55 ; 60)$, $[60; 65)$, $[65; 70)$.
</div>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
$[40; 45)$, $[45 ; 50)$, $[50; 55)$, $[55 ; 60)$, $[60; 65)$, $[65; 70)$.
\end{center}
:::

b. Xác định trung bình cộng, trung vị, tứ phân vị của mẫu số liệu ghép nhóm trên.

c.  Mốt của mẫu số liệu ghép nhóm trên là bao nhiêu?
</details>

<!-- LỜI GIẢI BÀI TẬP 1 -->
<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

<!-- KHUNG DỮ LIỆU -->
```{r, echo=FALSE}
# Các điểm chia
bai1$points <- seq(40, 70, by = 5)
# Các giá trị đại liện
bai1$x <- .5 * (bai1$points[-length(bai1$points)] + bai1$points[-1])
# Tần số
bai1$categories <- cut(bai1$data, bai1$points, right = FALSE)
bai1$f <- as.vector(table(bai1$categories))
# Tần số tích lũy
bai1$cf <- cumsum(bai1$f)
# Khung dữ liệu
bai1$df <- data.frame(
    ` ` = seq(1, length(bai1$points) - 1, by = 1),
    Nhóm = c(paste0("\\(", levels(bai1$categories), "\\)")),
    `Mút trái` = seq(40, 65, by = 5),
    `Mút phải` = seq(45, 70, by = 5),
    `Giá trị đại diện` = bai1$x,
    `Tần số` = bai1$f,
    `Tần số tích lũy` = bai1$cf,
    check.names = FALSE
)
```

a. Để đảm bảo phân nhóm chính xác, trước tiên mình sắp xếp số liệu theo thứ tự tăng dần. 

<!-- SẮP XẾP SỐ LIỆU TĂNG DẦN -->
```{r, echo=FALSE}
data <- format(matrix(sort(bai1$data), nrow = 4, byrow = TRUE), decimal.mark = ",")
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

Nhìn vào dãy có thứ tự tăng dần, bạn dễ dàng thấy rằng thuộc vào nhóm $[40,45)$ có bốn số liệu bao gồm 41; 43; 44; 44,5. Hãy tiếp tục quan sát để thu được bảng tần số ghép nhóm.

<!-- BẢNG TẦN SỐ GHÉP NHÓM -->
```{r, echo = FALSE}
# data <- data.frame(bai1$df[, c(-1, -3, -4, -5, -7), drop = FALSE], check.names = FALSE)
data <- rbind(bai1$df[, c(-1, -3, -4, -5, -7), drop = FALSE], c("", "\\(n=40\\)"))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", ";", x)
})
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

b. Mình thêm vào bảng tần số ghép nhóm ở trên cột số thứ tự để dễ quan sát, cột Giá trị đại diện để tính trung bình, và cột Tần số tích lũy để tính tứ phân vị. 

<!-- BẢNG TẦN SỐ GHÉP NHÓM MỞ RỘNG -->
```{r, echo = FALSE}
data <- rbind(bai1$df[, c(-3, -4), drop = FALSE], c("", "", "", "\\(n=40\\)", ""))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", "TEMP_MARKER", x) # Đổi dấu ',' thành ký hiệu tạm
    x <- gsub("\\.", ",", x) # Đổi dấu '.' thành ','
    gsub("TEMP_MARKER", ";", x) # Đổi ký hiệu tạm thành ';'
})
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}

```

<!-- TRUNG BÌNH -->
```{r, echo = FALSE}
# Kích thước mẫu
bai1$n <- length(bai1$data)
bai1$barx <- fractions(sum(bai1$df$`Giá trị đại diện` * bai1$df$`Tần số`) / sum(bai1$df$`Tần số`))
```

- Mẫu có $n=40$ số liệu. Nhóm một, $[40;45)$, có trung điểm $x_1=42,5$ làm giá trị đại diện và có tần số $n_1=4$. Ký hiệu tương tự cho các nhóm còn lại. Trung bình cộng là
\begin{align*}
    \bar{x} 
        & = \frac{1}{n} (n_1\cdot x_1 + n_2\cdot x_2 + n_3\cdot x_3 + n_4\cdot x_4 + n_5\cdot x_5 + n_6\cdot x_6) \\
        & = \frac{1}{40} (4\cdot 42,5 + 11\cdot 47,5 + 7\cdot 52,5 + 8\cdot 57,5 + 8\cdot 62,5 + 2\cdot 67,5) \\
        & = \frac{431}{8} \\
        & = `r format(round(as.numeric(bai1$barx), 4), decimal.mark = ",")` \text{ (km/h)}.
\end{align*}

<!-- TRUNG VỊ -->
```{r, echo = FALSE}
# Tìm nhóm trung vị
bai1$k <- which(bai1$df$`Tần số tích lũy` >= bai1$n / 2)[1]
# Mút trái nhóm trung vị
bai1$r <- bai1$df$`Mút trái`[bai1$k]
# Độ rộng nhóm
bai1$d <- bai1$df$`Mút phải`[bai1$k] - bai1$df$`Mút trái`[bai1$k]
# Tính trung vị
bai1$me <- fractions(bai1$r + ((bai1$n / 2 - ifelse(bai1$k > 1, bai1$df$`Tần số tích lũy`[bai1$k - 1], 0)) / bai1$df$`Tần số`[bai1$k]) * bai1$d)
```

- Nhóm ba, $[50;55)$, là nhóm đầu tiên có tần số tích lũy $cf_3=22$ không nhỏ hơn $\frac{n}{2}=20$. Nhóm này có đầu mút trái $r=50$, độ dài $d=5$ và tần số $n_3=7$. Nhóm hai có tần số tích lũy $cf_2=15$. Trung vị là
    \begin{align*}
        M_e
            & = r+\left(\frac{\frac{n}{2}-cf_2}{n_3}\right)\cdot d \\
            & = 50 + \left(\frac{20-15}{7}\right)\cdot 5 \\
            & = \frac{375}{7} \\
            & \approx `r format(round(as.numeric(bai1$me), 4), decimal.mark = ",")` \text{ (km/h).}
    \end{align*}

<!-- TỨ PHÂN VỊ THỨ NHẤT -->
```{r, echo = FALSE}
bai1$p <- which(bai1$df$`Tần số tích lũy` >= bai1$n / 4)[1]
# Mút trái nhóm tứ phân vị thứ nhất
bai1$s <- bai1$df$`Mút trái`[bai1$p]
# Độ rộng nhóm tứ phân vị thứ nhất
bai1$h <- bai1$df$`Mút phải`[bai1$p] - bai1$df$`Mút trái`[bai1$p]
# Tính tứ phân vị thứ nhất
bai1$q1 <- fractions(bai1$s + ((bai1$n / 4 - ifelse(bai1$p > 1, bai1$df$`Tần số tích lũy`[bai1$p - 1], 0)) / bai1$df$`Tần số`[bai1$p]) * bai1$h)
```

- Nhóm hai, $[45;50)$, là nhóm đầu tiên có tần số tích lũy $cf_2=15$ không nhỏ hơn $\frac{n}{4}=10$. Nhóm này có đầu mút trái $s=45$, độ dài $h=5$ và tần số $n_2=11$. Nhóm một có tần số tích lũy là $cf_1=4$. Tứ phân vị thứ nhất là
    \begin{align*}
        Q_1
            & = s + \left( \frac{\frac{n}{4}-cf_1}{n_2}\right)\cdot h \\
            & = 45 + \left(\frac{10-4}{11}\right)\cdot 5 \\
            & = \frac{525}{11} \\
            & \approx `r format(round(as.numeric(bai1$q1), 4), decimal.mark = ",")` \text{ (km/h).}
    \end{align*}

- Tứ phân vị thứ hai $Q_2$ chính là trung vị $M_e$, hay $Q_2 = M_e = `r format(round(as.numeric(bai1$me), 4), decimal.mark = ",")`$ (km/h).

<!-- TỨ PHÂN VỊ THỨ BA -->
```{r, echo = FALSE}
# Tìm nhóm tứ phân vị thứ ba
bai1$q <- which(bai1$df$`Tần số tích lũy` >= (3 * bai1$n) / 4)[1]
# Mút trái nhóm tứ phân vị thứ ba
bai1$t <- bai1$df$`Mút trái`[bai1$q]
# Độ rộng nhóm tứ phân vị thứ ba
bai1$l <- bai1$df$`Mút phải`[bai1$q] - bai1$df$`Mút trái`[bai1$q]
# Tính tứ phân vị thứ ba
bai1$q3 <- fractions(bai1$t + (((3 * bai1$n) / 4 - ifelse(bai1$q > 1, bai1$df$`Tần số tích lũy`[bai1$q - 1], 0)) / bai1$df$`Tần số`[bai1$q]) * bai1$l)
```

- Nhóm bốn, $[55;60)$, là nhóm đầu tiên có tần số tích lũy $cf_4=30$ bằng với $\frac{3n}{4}=\frac{3\cdot 40}{4}=30$. Nhóm này có đầu mút trái $t=55$, độ dài $l=5$ và tần số $n_4=8$. Nhóm thứ ba có tần số tích lũy là $cf_3=22$. Tứ phân vị thứ ba là
    \begin{align*}
        Q_3
            & = t + \left(\frac{\frac{3n}{4}-cf_3}{n_4}\right)\cdot l \\
            & = 55 + \left(\frac{30-22}{8}\right)\cdot 5 \\
            & = `r format(round(as.numeric(bai1$q3), 4), decimal.mark = ",")` \text{ (km/h).}
    \end{align*}

<!-- MỐT -->
```{r, echo = FALSE}
# Tìm nhóm có tần số lớn nhất
bai1$i <- which.max(bai1$df$`Tần số`)
# Mút trái của nhóm mốt
bai1$u <- bai1$df$`Mút trái`[bai1$i]
# Độ rộng nhóm mốt
bai1$g <- bai1$df$`Mút phải`[bai1$i] - bai1$df$`Mút trái`[bai1$i]
# Tính mốt
bai1$mo <- fractions(bai1$u + ((bai1$df$`Tần số`[bai1$i] - ifelse(bai1$i > 1, bai1$df$`Tần số`[bai1$i - 1], 0)) / (2 * bai1$df$`Tần số`[bai1$i] - ifelse(bai1$i > 1, bai1$df$`Tần số`[bai1$i - 1]) - ifelse(bai1$i < nrow(bai1$df), bai1$df$`Tần số`[bai1$i + 1], 0))) * bai1$g)
```

c. Nhóm hai, $[45;50)$, là nhóm có tần số lớn nhất $n_2=11$. Nó có đầu mút trái $u=45$ và độ dài $g=5$. Nhóm một có tần số $n_1=4$ và nhóm ba có tần số $n_3=7$. Mốt là
    \begin{align*}
        M_o
            & = u + \left(\frac{n_2-n_1}{2n_2-n_1-n_3}\right) \cdot g \\
            & = 45 + \left(\frac{11-4}{2\cdot 11-4-7}\right)\cdot 5 \\
            & = \frac{530}{11} \\
            & \approx `r format(round(as.numeric(bai1$mo), 4), decimal.mark = ",")` \text{ (km/h)}.
    \end{align*}

::: {.content-visible when-format="pdf"}
Tóm lại, bảng tần số ghép nhóm là
\begin{center}
\centering
\begin{tabular}{|c|c|c|c|c|c|}
\hline 
$[40; 45)$ & $[45 ; 50)$ & $[50; 55)$ & $[55 ; 60)$ & $[60; 65)$ & $[65; 70)$ \\
\hline 
4 & 11 & 7 & 8 & 8 & 2. \\
\hline
\end{tabular}
\end{center}

Các số đặc trưng đo xu thế trung tâm là
\begin{center}
\begin{tabular}{|c|c|c|c|c|}
\hline
$\bar{x}$ & $Q_1$ & $Q_2$ ($M_e$) & $Q_3$ & $M_o$ \\
\hline
`r format(round(as.numeric(bai1$barx), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai1$q1), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai1$me), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai1$q3), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai1$mo), 4), decimal.mark = ",")`. \\
\hline 
\end{tabular}
\end{center}
:::

::: {.ket-thuc}
:::
</details>

<!-- ĐÁP ÁN BÀI TẬP 1 -->
<details>

::: {.content-visible when-format="html"}
<summary class="dap-an">Đáp án</summary>
:::

```{r, echo = FALSE}
data <- rbind(bai1$df[, c(-3, -4), drop = FALSE], c("", "", "", "\\(n=40\\)", ""))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", "TEMP_MARKER", x) # Đổi dấu ',' thành ký hiệu tạm
    x <- gsub("\\.", ",", x) # Đổi dấu '.' thành ','
    gsub("TEMP_MARKER", ";", x) # Đổi ký hiệu tạm thành ';'
})
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = FALSE)
}
```

```{r, echo = FALSE}
# Tạo khung dữ liệu với một hàng duy nhất
data <- data.frame(
    `\\(\\bar{x}\\)` = format(round(as.numeric(bai1$barx), 4), decimal.mark = ","),
    `\\(Q_1\\)` = format(round(as.numeric(bai1$q1), 4), decimal.mark = ","),
    `\\(Q_2\\) (\\(M_e\\))` = format(round(as.numeric(bai1$me), 4), decimal.mark = ","),
    `\\(Q_3\\)` = format(round(as.numeric(bai1$q3), 4), decimal.mark = ","),
    `\\(M_o\\)` = format(round(as.numeric(bai1$mo), 4), decimal.mark = ","),
    check.names = FALSE
)
# Kiểm tra định dạng đầu ra
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
# Hiển thị bảng nếu định dạng đầu ra là HTML
if (output_format == "html") {
    knitr::kable(data, align = "c", format = "html") %>%
        kableExtra::kable_styling(
            bootstrap_options = c("striped", "hover", "condensed", "responsive"),
            full_width = FALSE
        )
}
```

</details>

<!-------------------------------------------------------------------->

<!-- BÀI TẬP 2 -->
<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Bài tập 2</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Bài tập 2}
:::

Mẫu số liệu sau ghi lại cân nặng của 30 bạn học sinh (đơn vị: kg):

<!-- DỮ LIỆU -->
```{r, echo = FALSE}
bai2 <- new.env()
# Tạo dữ liệu
bai2$data <- c(17.0, 40.0, 39.0, 40.5, 42.0, 51.0, 41.5, 39.0, 41.0, 30.0, 40.0, 42.0, 40.5, 39.5, 41.0, 40.5, 37.0, 39.5, 40.0, 41.0, 38.5, 39.5, 40.0, 41.0, 39.0, 40.5, 40.0, 38.5, 39.5, 41.5)
data <- matrix(bai2$data, nrow = 3, byrow = TRUE)
# Định dạng số thập phân: thay dấu "." bằng ","
data <- format(data, decimal.mark = ",")
# Bảng
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

a. Lập bảng tần số ghép nhóm cho mẫu số liệu trên có tám nhóm ứng với tám nửa khoảng:

::: {.content-visible when-format="html"}
<div style="text-align: center;">
$[15; 20)$, $[20; 25)$, $[25; 30)$, $[30; 35)$, $[35; 40)$, $[40 ; 45)$, $[45; 50)$, $[50; 55)$.
</div>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
$[15; 20)$, $[20; 25)$, $[25; 30)$, $[30; 35)$, $[35; 40)$, $[40 ; 45)$, $[45; 50)$, $[50; 55)$.
\end{center}
:::

b. Xác định trung bình cộng, trung vị, tứ phân vị của mẫu số liệu ghép nhóm trên.

c. Mốt của mẫu số liệu ghép nhóm trên là bao nhiêu?
</details>

<!-- LỜI GIẢI BÀI TẬP 2 -->
<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

<!-- KHUNG DỮ LIỆU -->
```{r, echo=FALSE}
# Các điểm chia
bai2$points <- seq(15, 55, by = 5)
# Các giá trị đại liện
bai2$x <- .5 * (bai2$points[-length(bai2$points)] + bai2$points[-1])
# Tần số
bai2$categories <- cut(bai2$data, bai2$points, right = FALSE)
bai2$f <- as.vector(table(bai2$categories))
# Tần số tích lũy
bai2$cf <- cumsum(bai2$f)
# Khung dữ liệu
bai2$df <- data.frame(
    ` ` = seq(1, length(bai2$points) - 1, by = 1),
    Nhóm = c(paste0("\\(", levels(bai2$categories), "\\)")),
    `Mút trái` = seq(15, 50, by = 5),
    `Mút phải` = seq(20, 55, by = 5),
    `Giá trị đại diện` = bai2$x,
    `Tần số` = bai2$f,
    `Tần số tích lũy` = bai2$cf,
    check.names = FALSE
)
```

a. Để đảm bảo phân nhóm chính xác, trước tiên mình sắp xếp số liệu theo thứ tự tăng dần. 

<!-- SẮP XẾP SỐ LIỆU TĂNG DẦN -->
```{r, echo=FALSE}
data <- format(matrix(sort(bai2$data), nrow = 3, byrow = TRUE), decimal.mark = ",")
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data,
        format = "html",
        align = "c", col.names = NA
    ) %>%
        kable_styling(
            bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE
        )
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

Nhìn vào dãy có thứ tự tăng dần, bạn dễ dàng thấy rằng thuộc vào nhóm $[15,20)$ chỉ có một số liệu là 17. Hãy tiếp tục quan sát để thu được bảng tần số ghép nhóm.

<!-- BẢNG TẦN SỐ GHÉP NHÓM -->
```{r, echo = FALSE}
data <- rbind(bai2$df[, c(-1, -3, -4, -5, -7), drop = FALSE], c("", "\\(n=40\\)"))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", ";", x)
})
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

b. Mình thêm vào bảng tần số ghép nhóm ở trên cột số thứ tự để dễ quan sát, cột Giá trị đại diện để tính trung bình, và cột Tần số tích lũy để tính tứ phân vị.

<!-- BẢNG TẦN SỐ GHÉP NHÓM MỞ RỘNG -->
```{r, echo = FALSE}
data <- rbind(bai2$df[, c(-3, -4), drop = FALSE], c("", "", "", "\\(n=40\\)", ""))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", "TEMP_MARKER", x) # Đổi dấu ',' thành ký hiệu tạm
    x <- gsub("\\.", ",", x) # Đổi dấu '.' thành ','
    gsub("TEMP_MARKER", ";", x) # Đổi ký hiệu tạm thành ';'
})
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

<!-- TRUNG BÌNH -->
```{r, echo = FALSE}
# Kích thước mẫu
bai2$n <- length(bai2$data)
bai2$barx <- fractions(sum(bai2$df$`Giá trị đại diện` * bai2$df$`Tần số`) / sum(bai2$df$`Tần số`))
```

- Mẫu có $n=30$ số liệu. Nhóm một, $[15;20)$, có trung điểm $x_1=17,5$ làm giá trị đại diện và có tần số $n_1=1$. Ký hiệu tương tự với các nhóm còn lại. Trung bình là
\begin{align*}
\bar{x}
    & = \frac{1}{n}(n_1\cdot x_1 + n_2\cdot x_2 + n_3\cdot x_3 + n_4\cdot x_4 + n_5\cdot x_5 + n_6\cdot x_6 + n_7\cdot x_7 + n_8\cdot x_8) \\
    & = \frac{1}{30} (1\cdot 17,5 + 0\cdot 22,5 + 0\cdot 27,5+ 1\cdot 32,5 + 10\cdot 37,5 + 17\cdot 42,5 + 0\cdot 47,5 + 52,5 \cdot 1) \\
    & = `r format(round(as.numeric(bai2$barx), 4), decimal.mark = ",")` \text{ (kg).}
\end{align*}

<!-- TRUNG VỊ -->
```{r, echo = FALSE}
# Tìm nhóm trung vị
bai2$k <- which(bai2$df$`Tần số tích lũy` >= bai2$n / 2)[1]
# Mút trái nhóm trung vị
bai2$r <- bai2$df$`Mút trái`[bai2$k]
# Độ rộng nhóm
bai2$d <- bai2$df$`Mút phải`[bai2$k] - bai2$df$`Mút trái`[bai2$k]
# Tính trung vị
bai2$me <- fractions(bai2$r + ((bai2$n / 2 - ifelse(bai2$k > 1, bai2$df$`Tần số tích lũy`[bai2$k - 1], 0)) / bai2$df$`Tần số`[bai2$k]) * bai2$d)
```

- Nhóm sáu, $[40;45)$, là nhóm đầu tiên có tần số tích lũy $cf_6=29$ không nhỏ hơn $\frac{n}{2}=15$. Nhóm này có đầu mút trái $r=40$, độ dài $d=5$ và tần số $n_6=17$. Nhóm năm liền trước nó có tần số tích lũy $cf_5=12$. Trung vị là
\begin{align*}
M_e
    & = r + \left(\frac{\frac{n}{2}-cf_5}{n_6}\right)\cdot d \\
    & = 40 + \left(\frac{15-12}{17}\right)\cdot 5 \\
    & = \frac{695}{17} \\
    & \approx `r format(round(as.numeric(bai2$me), 4), decimal.mark = ",")` \text{ (kg).}
\end{align*}

<!-- TỨ PHÂN VỊ THỨ NHẤT -->
```{r, echo = FALSE}
bai2$p <- which(bai2$df$`Tần số tích lũy` >= bai2$n / 4)[1]
# Mút trái nhóm tứ phân vị thứ nhất
bai2$s <- bai2$df$`Mút trái`[bai2$p]
# Độ rộng nhóm tứ phân vị thứ nhất
bai2$h <- bai2$df$`Mút phải`[bai2$p] - bai2$df$`Mút trái`[bai2$p]
# Tính tứ phân vị thứ nhất
bai2$q1 <- fractions(bai2$s + ((bai2$n / 4 - ifelse(bai2$p > 1, bai2$df$`Tần số tích lũy`[bai2$p - 1], 0)) / bai2$df$`Tần số`[bai2$p]) * bai2$h)
```

- Nhóm năm $[35;40)$ là nhóm đầu tiên có tần số tích lũy $cf_5=12$ không nhỏ hơn $\frac{n}{4}=7,5$. Nhóm này có đầ mút trái $s=35$, độ dài $h=5$ và tần số $n_5=10$. Nhóm bốn liền trước nó có tần số tích lũy $cf_4=2$. Tứ phân vị thứ nhất là
\begin{align*}
Q_1
    & = s + \left( \frac{\frac{n}{4}-cf_4}{n_5}\right)\cdot h \\
    & = 35 + \left(\frac{7,5-2}{10}\right)\cdot 5 \\
    & = \frac{151}{4} \\
    & = `r format(round(as.numeric(bai2$q1), 4), decimal.mark = ",")` \text{ (kg).}
\end{align*}

- Tứ phân vị thứ hai $Q_2$ chính là trung vị $M_e$, hay $Q_2=M_e \approx `r format(round(as.numeric(bai2$me), 4), decimal.mark = ",")`$ (kg).

<!-- TỨ PHÂN VỊ THỨ BA -->
```{r, echo = FALSE}
# Tìm nhóm tứ phân vị thứ ba
bai2$q <- which(bai2$df$`Tần số tích lũy` >= (3 * bai2$n) / 4)[1]
# Mút trái nhóm tứ phân vị thứ ba
bai2$t <- bai2$df$`Mút trái`[bai2$q]
# Độ rộng nhóm tứ phân vị thứ ba
bai2$l <- bai2$df$`Mút phải`[bai2$q] - bai2$df$`Mút trái`[bai2$q]
# Tính tứ phân vị thứ ba
bai2$q3 <- fractions(bai2$t + (((3 * bai2$n) / 4 - ifelse(bai2$q > 1, bai2$df$`Tần số tích lũy`[bai2$q - 1], 0)) / bai2$df$`Tần số`[bai2$q]) * bai2$l)
```

- Nhóm sáu $[40;45)$ là nhòm đầu tiên có tần số tích lũy $cf_6=29$ không nhỏ hơn $\frac{3n}{4}=22,5$. Nhóm này có đầu mút trái $t=40$, độ dài $l=5$ và tần số $n_6=17$. Nhóm năm liền trước nó có tần số tích lũy là $cf_5=12$. Tứ phân vị thứ ba là
\begin{align*}
Q_3
    & = t + \left(\frac{\frac{3n}{4}-cf_5}{n_6}\right)\cdot l \\
    & = 40 +\left(\frac{22,5-12}{17}\right) \cdot 5 \\
    & = \frac{1465}{34} \\
    & \approx `r format(round(as.numeric(bai2$q3), 4), decimal.mark = ",")` \text{ (kg).} 
\end{align*}

<!-- MỐT -->
```{r, echo = FALSE}
# Tìm nhóm có tần số lớn nhất
bai2$i <- which.max(bai2$df$`Tần số`)
# Mút trái của nhóm mốt
bai2$u <- bai2$df$`Mút trái`[bai2$i]
# Độ rộng nhóm mốt
bai2$g <- bai2$df$`Mút phải`[bai2$i] - bai2$df$`Mút trái`[bai2$i]
# Tính mốt
bai2$mo <- fractions(bai2$u + ((bai2$df$`Tần số`[bai2$i] - ifelse(bai2$i > 1, bai2$df$`Tần số`[bai2$i - 1], 0)) / (2 * bai2$df$`Tần số`[bai2$i] - ifelse(bai2$i > 1, bai2$df$`Tần số`[bai2$i - 1]) - ifelse(bai2$i < nrow(bai2$df), bai2$df$`Tần số`[bai2$i + 1], 0))) * bai2$g, 4)
```

c. Nhóm sáu $[40,45)$ là nhóm có tần số lớn nhất $n_6=17$. Nhóm này có đầu mút trái $u=40$ và độ dài $g=5$. Nhóm năm liền trước nó có tần số $n_5=10$ và nhóm bảy liền sau nó có tần số $n_7=0$. Mốt là
\begin{align*}
M_o 
    & = u + \left(\frac{n_6-n_5}{2n_6 - n_5 - n_7}\right)\cdot g \\
    & = 40 + \left(\frac{17-10}{2\cdot 17 - 10 - 0}\right)\cdot 5 \\
    & = \frac{995}{24} \\
    & \approx `r formatC(round(as.numeric(bai2$mo), 4), format = "f", digits = 1, decimal.mark = ",")` \text{ (kg).}
\end{align*}

::: {.content-visible when-format="pdf"}
Tóm lại, bảng tần số ghép nhóm là
\begin{center}
\begin{tabular}{|c|c|c|c|c|c|c|c|}
\hline 
$[15;20)$ & $[20; 25)$ & $[25; 30)$ & $[30; 35)$ & $[35;40)$ & $[40; 45)$ & $[45;50)$ & $[50;55)$ \\
\hline 
1 & 0 & 0 & 1 & 10 & 17 & 0 & 1. \\
\hline
\end{tabular}
\end{center}

Các số đặc trưng đo xu thế trung tâm là
\begin{center}
\begin{tabular}{|c|c|c|c|c|}
\hline
$\bar{x}$ & $Q_1$ & $Q_2$ ($M_e$) & $Q_3$ & $M_o$ \\
\hline
`r format(round(as.numeric(bai2$barx), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai2$q1), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai2$me), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai2$q3), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai2$mo), 4), decimal.mark = ",")`. \\
\hline 
\end{tabular}
\end{center}
:::

::: {.ket-thuc}
:::
</details>

<!-- ĐÁP ÁN BÀI TẬP 2 -->
<details>

::: {.content-visible when-format="html"}
<summary class="dap-an">Đáp án</summary>
:::

```{r, echo = FALSE}
data <- rbind(bai2$df[, c(-3, -4), drop = FALSE], c("", "", "", "\\(n=40\\)", ""))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", "TEMP_MARKER", x) # Đổi dấu ',' thành ký hiệu tạm
    x <- gsub("\\.", ",", x) # Đổi dấu '.' thành ','
    gsub("TEMP_MARKER", ";", x) # Đổi ký hiệu tạm thành ';'
})
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = FALSE)
}

```

```{r, echo = FALSE}
# Tạo khung dữ liệu với một hàng duy nhất
data <- data.frame(
    `\\(\\bar{x}\\)` = format(round(as.numeric(bai2$barx), 4), decimal.mark = ","),
    `\\(Q_1\\)` = format(round(as.numeric(bai2$q1), 4), decimal.mark = ","),
    `\\(Q_2\\) (\\(M_e\\))` = format(round(as.numeric(bai2$me), 4), decimal.mark = ","),
    `\\(Q_3\\)` = format(round(as.numeric(bai2$q3), 4), decimal.mark = ","),
    `\\(M_o\\)` = format(round(as.numeric(bai2$mo), 4), decimal.mark = ","),
    check.names = FALSE
)
# Kiểm tra định dạng đầu ra
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
# Hiển thị bảng nếu định dạng đầu ra là HTML
if (output_format == "html") {
    knitr::kable(data, align = "c", format = "html") %>%
        kableExtra::kable_styling(
            bootstrap_options = c("striped", "hover", "condensed", "responsive"),
            full_width = FALSE
        )
}
```

</details>

<!-------------------------------------------------------------------->

<!-- BÀI TẬP 3 -->
<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Bài tập 3</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Bài tập 3}
:::

Bảng 15 cho ta bảng tần số ghép nhóm số liệu thống kê chiều cao của 40 mẫu cây ở một vườn thực vật (đơn vị: cm).

a. Xác định trung bình cộng, trung vị, tứ phân vị của mẫu số liệu ghép nhóm trên.

b. Mốt của mẫu số liệu ghép nhóm trên là bao nhiêu?

<!-- KHUNG DỮ LIỆU -->
```{r, echo = FALSE}
bai3 <- new.env()
bai3$df <- data.frame(
    ` ` = c(1, 2, 3, 4, 5, 6),
    `Nhóm` = c("\\([30;40)\\)", "\\([40;50)\\)", "\\([50;60)\\)", "\\([60;70)\\)", "\\([70;80)\\)", "\\([80;90)\\)"),
    `Mút trái` = seq(30, 80, by = 10),
    `Mút phải` = seq(40, 90, by = 10),
    `Giá trị đại diện` = .5 * (seq(30, 80, by = 10) + seq(40, 90, by = 10)),
    `Tần số` = c(4, 10, 14, 6, 4, 2),
    `Tần số tích lũy` = c(4, 14, 28, 34, 38, 40),
    check.names = FALSE
)
data <- data.frame(bai3$df[, c(-1, -3, -4, -5), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "\\(n=40\\)", ""))
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA, caption = "Bảng 15") %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

</details>

<!-- LỜI GIẢI BÀI TẬP 3 -->
<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

a. Mình sẽ thêm vào bảng đã cho cột Giá trị đại diện để tính trung bình, và cột số thứ tự để dễ quan sát.

<!-- BẢNG TẦN SỐ MỞ RỘNG -->
```{r, echo = FALSE}
data <- rbind(bai3$df[, c(-3, -4), drop = FALSE], c("", "", "", "\\(n=40\\)", ""))
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE) 
}
```

<!-- TRUNG BÌNH -->
```{r, echo = FALSE}
bai3$n <- sum(bai3$df$`Tần số`)
bai3$barx <- fractions((1 / bai3$n) * sum(bai3$df$`Giá trị đại diện` * bai3$df$`Tần số`))
```

- Mẫu có $n=40$ số liệu. Nhóm một có giá trị đại diện $x_1=35$ và tần số $n_1=4$, vân vân cho đến nhóm sáu có giá trị đại diện $x_6=85$ và tần số $n_6=2$. Trung bình là

\begin{align*}
    \bar{x}
        & = \frac{1}{n}(n_1\cdot x_1 + n_2\cdot x_2 + n_3\cdot x_3 + n_4\cdot x_4 + n_5\cdot x_5 + n_6\cdot x_6) \\
        & = \frac{1}{40} (4\cdot 35 + 10\cdot 45 + 14\cdot 55 + 6\cdot 65 + 4\cdot 75 + 2\cdot 85) \\
        & = \frac{111}{2} \\
        & = `r format(round(as.numeric(bai3$barx), 4), decimal.mark = ",")` \text{ (cm).}
\end{align*}

<!-- TRUNG VỊ -->
```{r, echo = FALSE}
# Tìm nhóm trung vị
bai3$k <- which(bai3$df$`Tần số tích lũy` >= bai3$n / 2)[1] # Tìm chỉ mục (vị trí hàng) đầu tiên ([1]) trong bai3$df sao cho giá trị của cột "Tần số tích lũy" lớn hơn hoặc bằng bai3$n / 2, rồi lưu vào bai3$k.
# Mút trái nhóm trung vị
bai3$r <- bai3$df$`Mút trái`[bai3$k]
# Độ rộng nhóm
bai3$d <- bai3$df$`Mút phải`[bai3$k] - bai3$df$`Mút trái`[bai3$k]
# Tính trung vị
bai3$me <- fractions(bai3$r + ((bai3$n / 2 - ifelse(bai3$k > 1, bai3$df$`Tần số tích lũy`[bai3$k - 1], 0)) / bai3$df$`Tần số`[bai3$k]) * bai3$d)
```

- Nhóm ba, $[50;55)$, là nhóm đầu tiên có tần số tích lũy $cf_3=28$ không nhỏ hơn $\frac{n}{2}=20$. Nhóm này có đầu mút trái $r=50$, độ dài $d=10$ và tần số $n_3=14$. Nhóm hai liền trước nó có tần số tích lũy $cf_2=14$. Trung vị là

\begin{align*}
M_e
    & = r + \left(\frac{\frac{n}{2}-cf_2}{n_3}\right)\cdot d \\
    & = 50 + \left(\frac{20-14}{14}\right)\cdot 10 \\
    & = \frac{380}{7} \\
    & \approx `r format(round(as.numeric(bai3$me), 4), decimal.mark = ",")` \text{ (cm).}
\end{align*}

<!-- TỨ PHÂN VỊ THỨ NHẤT Q1 -->
```{r, echo = FALSE}
# Tìm nhóm tứ phân vị thứ nhất
bai3$p <- which(bai3$df$`Tần số tích lũy` >= bai3$n / 4)[1]
# Mút trái nhóm tứ phân vị thứ nhất
bai3$s <- bai3$df$`Mút trái`[bai3$p]
# Độ rộng nhóm tứ phân vị thứ nhất
bai3$h <- bai3$df$`Mút phải`[bai3$p] - bai3$df$`Mút trái`[bai3$p]
# Tính tứ phân vị thứ nhất
bai3$q1 <- fractions(bai3$s + ((bai3$n / 4 - ifelse(bai3$p > 1, bai3$df$`Tần số tích lũy`[bai3$p - 1], 0)) / bai3$df$`Tần số`[bai3$p]) * bai3$h)
```

- Nhóm hai, $[40;50)$, là nhóm đầu tiên có tần số tích lũy $cf_2=14$ không nhỏ hơn $\frac{n}{4}=10$. Nhóm này có đầu mút trái $s=40$, độ dài $h=10$ và tần số $n_2=10$. Nhóm một có tần số tích lũy là $cf_1=4$. Tứ phân vị thứ nhất là

    \begin{align*}
        Q_1
            & = s + \left( \frac{\frac{n}{4}-cf_1}{n_2}\right)\cdot h \\
            & = 40 + \left(\frac{10-4}{10}\right)\cdot 10 \\
            & = `r format(round(as.numeric(bai3$q1), 4), decimal.mark = ",")` \text{ (cm).}
    \end{align*}

- Tứ phân vị thứ hai $Q_2$ chính là trung vị $M_e$, hay $Q_2 = M_e = `r format(round(as.numeric(bai3$me), 4), decimal.mark = ",")`$ (cm).

<!-- TỨ PHÂN VỊ THỨ BA Q3 -->
```{r, echo = FALSE}
# Tìm nhóm tứ phân vị thứ ba
bai3$q <- which(bai3$df$`Tần số tích lũy` >= (3 * bai3$n) / 4)[1]
# Mút trái nhóm tứ phân vị thứ ba
bai3$t <- bai3$df$`Mút trái`[bai3$q]
# Độ rộng nhóm tứ phân vị thứ ba
bai3$l <- bai3$df$`Mút phải`[bai3$q] - bai3$df$`Mút trái`[bai3$q]
# Tính tứ phân vị thứ ba
bai3$q3 <- fractions(bai3$t + (((3 * bai3$n) / 4 - ifelse(bai3$q > 1, bai3$df$`Tần số tích lũy`[bai3$q - 1], 0)) / bai3$df$`Tần số`[bai3$q]) * bai3$h)
```

- Nhóm bốn, $[60;70)$, là nhóm đầu tiên có tần số tích lũy $cf_4=34$ không nhỏ hơn $\frac{3n}{4}=30$. Nhóm này có đầu mút trái $t=60$, độ dài $l=10$ và tần số $n_4=6$. Nhóm thứ ba có tần số tích lũy là $cf_3=28$. Tứ phân vị thứ ba là

    \begin{align*}
        Q_3
            & = t + \left(\frac{\frac{3n}{4}-cf_3}{n_4}\right)\cdot l \\
            & = 60 + \left(\frac{30-28}{6}\right)\cdot 10 \\
            & = \frac{190}{3} \\
            & = `r format(round(as.numeric(bai3$q3), 4), decimal.mark = ",")` \text{ (cm).}
    \end{align*}

<!-- MỐT -->
```{r, echo = FALSE}
# Tìm nhóm có tần số lớn nhất
bai3$i <- which.max(bai3$df$`Tần số`)
# Mút trái của nhóm mốt
bai3$u <- bai3$df$`Mút trái`[bai3$i]
# Độ rộng nhóm mốt
bai3$g <- bai3$df$`Mút phải`[bai3$i] - bai3$df$`Mút trái`[bai3$i]
# Tính mốt
bai3$mo <- fractions(bai3$u + ((bai3$df$`Tần số`[bai3$i] - ifelse(bai3$i > 1, bai3$df$`Tần số`[bai3$i - 1], 0)) / (2 * bai3$df$`Tần số`[bai3$i] - ifelse(bai3$i > 1, bai3$df$`Tần số`[bai3$i - 1]) - ifelse(bai3$i < nrow(bai3$df), bai3$df$`Tần số`[bai3$i + 1], 0))) * bai3$g, 4)
```

b. Nhóm ba, $[50;60)$, là nhóm có tần số lớn nhất $n_3=14$. Nó có đầu mút trái $u=50$ và độ dài $g=10$. Nhóm hai có tần số $n_2=10$ và nhóm bốn có tần số $n_4=6$. Mốt là
    \begin{align*}
        M_o
            & = u + \left(\frac{n_3-n_2}{2n_3-n_2-n_4}\right) \cdot g \\
            & = 50 + \left(\frac{14-10}{2\cdot 14-10-6}\right)\cdot 10 \\
            & = \frac{160}{3} \\
            & \approx `r format(round(as.numeric(bai3$mo), 4), decimal.mark = ",")` \text{ (cm)}.
    \end{align*}

::: {.content-visible when-format="pdf"}
Tóm lại, bảng tần số ghép nhóm là
\begin{center}
\begin{tabular}{|c|c|c|c|c|c|}
\hline 
$[30;40)$ & $[40;50)$ & $[50;60)$ & $[60;70)$ & $[70;80)$ & $[80;90)$  \\
\hline 
1 & 0 & 0 & 1 & 10 & 17. \\
\hline
\end{tabular}
\end{center}

Các số đặc trưng đo xu thế trung tâm là
\begin{center}
\begin{tabular}{|c|c|c|c|c|}
\hline
$\bar{x}$ & $Q_1$ & $Q_2$ ($M_e$) & $Q_3$ & $M_o$ \\
\hline
`r format(round(as.numeric(bai3$barx), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai3$q1), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai3$me), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai3$q3), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai3$mo), 4), decimal.mark = ",")`. \\
\hline 
\end{tabular}
\end{center}
:::

::: {.ket-thuc}
:::
</details>

<!-- ĐÁP ÁN BÀI TẬP 3 -->
<details>

::: {.content-visible when-format="html"}
<summary class="dap-an">Đáp án</summary>
:::

```{r, echo = FALSE}
data <- rbind(bai3$df[, c(-3, -4), drop = FALSE], c("", "", "", "\\(n=40\\)", ""))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", "TEMP_MARKER", x) # Đổi dấu ',' thành ký hiệu tạm
    x <- gsub("\\.", ",", x) # Đổi dấu '.' thành ','
    gsub("TEMP_MARKER", ";", x) # Đổi ký hiệu tạm thành ';'
})
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = FALSE)
}

```

```{r, echo = FALSE}
# Tạo khung dữ liệu với một hàng duy nhất
data <- data.frame(
    `\\(\\bar{x}\\)` = format(round(as.numeric(bai3$barx), 4), decimal.mark = ","),
    `\\(Q_1\\)` = format(round(as.numeric(bai3$q1), 4), decimal.mark = ","),
    `\\(Q_2\\) (\\(M_e\\))` = format(round(as.numeric(bai3$me), 4), decimal.mark = ","),
    `\\(Q_3\\)` = format(round(as.numeric(bai3$q3), 4), decimal.mark = ","),
    `\\(M_o\\)` = format(round(as.numeric(bai3$mo), 4), decimal.mark = ","),
    check.names = FALSE
)
# Kiểm tra định dạng đầu ra
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
# Hiển thị bảng nếu định dạng đầu ra là HTML
if (output_format == "html") {
    knitr::kable(data, align = "c", format = "html") %>%
        kableExtra::kable_styling(
            bootstrap_options = c("striped", "hover", "condensed", "responsive"),
            full_width = FALSE
        )
}
```

</details>


<!-- STORE -->

<!--
<button class="bai-tap" onclick="toggleContent()">
Bài tập 1
</button>

<div class="bai-tap-content" id="hiddenContent" >
<p>Đây là nội dung bài tập.</p>
$$n=2$$
</div>

<script>
function toggleContent() {
var content = document.getElementById("hiddenContent");
content.style.display = (content.style.display === "none") ? "block" : "none";
}
</script>
-->