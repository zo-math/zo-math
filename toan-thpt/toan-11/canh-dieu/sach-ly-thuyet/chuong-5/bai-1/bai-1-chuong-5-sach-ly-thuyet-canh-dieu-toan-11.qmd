---
title: "Bài 1. Các số đặc trưng đo xu thế trung tâm cho mẫu số liệu ghép nhóm"
subtitle: "Chương 5 | Cánh Diều | Toán 11"
author: "ZO | `r Sys.Date()`"
---

```{r setup, include=FALSE}
library(knitr)
library(kableExtra)
library(dplyr)
library(MASS)
# library(ggplot2)
```

Nếu không có yêu cầu làm tròn đặc biệt, các con số sẽ được làm tròn đến 4 chữ số thập phân để tiện đối chiếu khi bạn tự tìm đáp án. 

<!-- Hoạt động 1 -->

<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Hoạt động 1</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Hoạt động 1}
:::

Trong *Bảng 1*, ta thấy:

- Có 13 ô-tô có độ tuổi dưới 4;
- Có 29 ô-tô có độ tuổi từ 4 đến dưới 8.

Hãy xác định số ô-tô có độ tuổi:

- Từ 8 đến dưới 12;
- Từ 12 đến dưới 16;
- Từ 16 đến dưới 20.

<!-- Khung dữ liệu Hoạt động 1 -->

```{r}
hd1 <- new.env()
hd1$df <- data.frame(
    ` ` = c(1, 2, 3, 4, 5),
    `Nhóm` = c("\\([0;4)\\)", "\\([4;8)\\)", "\\([8;12)\\)", "\\([12;16)\\)", "\\([16;20)\\)"),
    `Mút trái` = seq(0, 16, by = 4),
    `Mút phải` = seq(4, 20, by = 4),
    `Giá trị đại diện` = .5 * (seq(0, 16, by = 4) + seq(4, 20, by = 4)),
    `Tần số` = c(13, 29, 48, 22, 8),
    `Tần số tích lũy` = cumsum(c(13, 29, 48, 22, 8)),
    check.names = FALSE
)
data <- data.frame(hd1$df[, c(-1, -3, -4, -5, -7), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "\\(n=120\\)"))
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA, caption = "Bảng 1") %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

</details>

<!-- Lời giải Hoạt động 1 -->

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải Hoạt động 1</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

::: {.callout-note title="Mẹo" collapse="true" appearance="simple" icon="false"}
Bạn có biết? Khi chưa quen với cách lập luận, bắt chước sách giáo khoa là một cách tốt để làm quen với cách trình bày. Khi đã hiểu rõ, bạn có thể tự phát triển cách lập luận của riêng mình.
:::

Từ *Bảng 1*, quan sát theo hàng để đếm số ô-tô trong từng nhóm độ tuổi.

- Có 48 ô-tô có độ tuổi từ 8 đến dưới 12.
- Có 22 ô-tô có độ tuổi từ 12 đến dưới 16.
- Có 8 ô-tô có độ tuổi từ 16 đến dưới 20.

::: {.ket-thuc}
:::

::: {.callout-note title="Nhóm & tần số" collapse="true" appearance="simple" icon="false"}

Việc xác định có 13 ô-tô có độ tuổi dưới 4 cho mình biết rằng nhóm $[0;4)$ có tần số 13.

- **Nhóm**: $[a; b)$, chứa một số giá trị của mẫu số liệu, $a$ là *đầu mút trái*, $b$ là *đầu mút phải*. *Độ dài* nhóm là $b-a$.
- **Tần số**: số giá trị của mẫu số liệu có trong nhóm $[a; b)$.

Biết có 13 ô-tô có độ tuổi dưới 4, nhưng không biết tuổi cụ thể của từng ô-tô. 
:::

::: {.callout-note title="Khám phá" collapse="true" appearance="minimal" icon="false"}
Nhìn vào bảng số liệu, bạn có nhận xét gì về số lượng ô-tô theo từng nhóm độ tuổi?

- Số lượng ô-tô cũ (trên 12 năm) có ít hơn xe mới không?
- Điều này có ý nghĩa gì?
:::

</details>

<!-- Luyện tập 1 -->

<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Luyện tập 1</summary>
:::

:::{.content-visible when-format="pdf"}
\section*{Luyện tập 1}
:::

Mẫu số liệu ghép nhóm ở *Bảng 1* có bao nhiêu số liệu? Bao nhiêu nhóm? Tìm tần số của mỗi nhóm.

```{r}
data <- data.frame(hd1$df[, c(-1, -3, -4, -5, -7), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "\\(n=120\\)"))
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA, caption = "Bảng 1") %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

</details>

<!-- Lời giải Luyện tập 1 -->

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải Luyện tập 1</summary>
:::

:::{.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

- Mẫu số liệu ghép nhóm ở *Bảng 1* có 120 số liệu, chính là tổng của cột Tần số. 
- Mẫu số liệu này có 5 nhóm, bao gồm $[0;4)$, $[4;8)$, $[8;12)$, $[12;16)$ và $[16;20)$. Để ngắn gọn, gọi các nhóm này lần lượt là 1, 2, 3, 4 và 5.
- Tần số của các nhóm 1, 2, 3, 4, 5 lần lượt là 13, 29, 48, 22, 8.

::: {.ket-thuc}
:::

</details>

<!-- Hoạt động 2 -->

<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Hoạt động 2</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Hoạt động 2}
:::

Một trường trung học phổ thông chọn 36 học sinh nam của khối lớp 11, đo chiều cao của các bạn học sinh đó và thu được mẫu số liệu sau (đơn vị: cm):

<!-- Dữ liệu Hoạt động 2 -->

```{r, echo = FALSE}
hd2 <- new.env()
# Tạo dữ liệu
hd2$data <- c(160, 161, 161, 162, 162, 162, 163, 163, 163, 164, 164, 164, 164, 165, 165, 165, 165, 165, 166, 166, 166, 166, 167, 167, 168, 168, 168, 168, 169, 169, 170, 171, 171, 172, 172, 174)
data <- matrix(hd2$data, nrow = 3, byrow = TRUE)
# Định dạng số thập phân: thay dấu "." bằng ","
data <- format(data, decimal.mark = ",")
# Bảng
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA) %>%
        kable_styling(latex_options = "hold_position")
}
```

Từ mẫu số liệu không ghép nhóm trên, hãy ghép các số liệu thành năm nhóm theo các nửa khoảng có độ dài bằng nhau.

</details>

<!-- Lời giải Hoạt động 2 -->

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải Hoạt động 2</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
Lời giải
\end{center}
:::

::: {.callout-note title="Nhận thức quan trọng" collapse="true" appearance="simple" icon="false"}
Ở Hoạt động 1, chúng mình làm việc với một bảng tần số ghép nhóm đã có sẵn, nhưng không biết chính xác các số liệu gốc.

Sang Hoạt động 2, tình huống đảo ngược: số liệu cụ thể được cho, nhưng bảng tần số thì chưa có. Nhiệm vụ của chúng mình là ghép các số liệu thành năm nhóm có độ dài bằng nhau.

Điều thú vị là, với hai tiêu chí "số lượng nhóm" và "độ dài nhóm", mình chưa thể xác lập một cách ghép nhóm duy nhất. Vẫn còn nhiều cách khác nhau để chia nhóm, và đây chính là cơ hội để khám phá sâu hơn về cấu trúc dữ liệu.

> - Hoạt động 1: Có bảng tần số nhưng thiếu số liệu.
> - Hoạt động 2: Có số liệu nhưng cần tự ghép nhóm, và việc ghép nhóm không có duy nhất một cách làm.

:::

Số liệu nhỏ nhất là 160, số liệu lớn nhất là 174, nên miền chứa dữ liệu là $[160; 174]$. Cần chia miền này thành 5 nhóm có độ dài bằng nhau, nên độ dài mỗi nhóm là
$$
    \frac{174-160}{5}=2,8.
$$

Nhưng nếu chia nhóm theo độ dài 2,8 cm, sẽ gặp các ranh giới không đẹp: 

::: {.center}
$[160;162,8)$, $[162,8;165,6)$, $[165,6;168,4)$, $[168,4;171,2)$, $[171,2;174]$.
:::

Rõ ràng, các số thập phân như 2,8; 162,8; 165,6; 168,4; 171,2 rất khó đọc, khó vẽ biểu đồ và không phù hợp với cách làm thống kê trong thực tế.

Số 3 là số nguyên nhỏ nhất gần với 2,8. Nếu chọn độ dài nhóm là 3, miền dữ liệu cần mở rộng ra một chút để bao phủ toàn bộ dữ liệu cũ. Lúc này, nếu vẫn giữ đầu dưới là 160, thì đầu trên là
$$
    160+5\cdot 3 = 175.
$$

Khi đó, các nhóm mới là 

::: {.center}
$[160;163)$, $[163;166)$, $[166;169)$, $[169;172)$, $[172;175)$.
:::

Nhóm cuối mình ghi là nửa khoảng, $[172; 175)$, vì 175 không có trong số liệu gốc.

::: {.ket-thuc}
:::

::: {.callout-note title="Khám phá" collapse="true" appearance="minimal" icon="false"}
Có điều gì ngăn cản mình chọn ghép các số liệu thành năm nhóm sau đây không: 

::: {.center}
$(159;162]$, $(162;165]$, $(165;168]$, $(168;171]$, $(171;174]$;
:::

hoặc

::: {.center}
$[159;162)$, $[162;165)$, $[165;168)$, $[168;171)$, $[171;174]$?
:::

Nếu không, câu hỏi kế tiếp là có bao nhiêu cách ghép nhóm? Cách nào là tốt nhất và dựa trên tiêu chí nào để khẳng định?
:::

</details>

<!-- Luyện tập 2 -->

<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Luyện tập 2</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Luyện tập 2}
:::

Một thư viện thống kê số người đến đọc sách vào buổi tối trong 30 ngày của tháng vừa qua như sau:

```{r, echo=FALSE}
lt2 <- new.env()
# Tạo dữ liệu
lt2$data <- c(85, 81, 65, 58, 47, 30, 51, 92, 85, 42, 55, 37, 31, 82, 63, 33, 44, 93, 77, 57, 44, 74, 63, 67, 46, 73, 52, 53, 47, 35)
data <- matrix(lt2$data, nrow = 3, byrow = TRUE)
# Định dạng số thập phân: thay dấu "." bằng ","
data <- format(data, decimal.mark = ",")
# Bảng
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA) %>%
        kable_styling(latex_options = "hold_position")
}
```

Lập bảng tần số ghép nhóm có tám nhóm ứng với tám nửa khoảng sau: $[25; 34)$, $[34; 43)$, $[43; 52)$, $[52; 61)$, $[61; 70)$, $[70; 79)$, $[79 ; 88)$, $[88; 97)$.

</details>

<!-- Lời giải luyện tập 2 -->

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải Luyện tập 2</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

::: {.callout-note title="Mẹo" collapse="true" appearance="simple" icon="false"}
Sắp xếp số liệu theo thứ tự tăng dần giúp mình dễ phân nhóm hơn.
:::

Để đảm bảo phân nhóm chính xác, hãy sắp xếp số liệu theo thứ tự tăng dần. 

<!-- Sắp xếp số liệu tăng dần -->

```{r, echo=FALSE}
data <- format(matrix(sort(lt2$data), nrow = 3, byrow = TRUE))
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

Nhìn vào dãy có thứ tự tăng dần, dễ dàng thấy rằng thuộc vào nhóm $[25;34)$ có ba số liệu bao gồm 30; 31; 33. Hãy tiếp tục quan sát để thu được bảng tần số ghép nhóm.

<!-- Bảng tần số ghép nhóm -->

```{r, echo = FALSE}
lt2$points <- seq(25, 97, by = 9)
# Các giá trị đại liện
lt2$x <- .5 * (lt2$points[-length(lt2$points)] + lt2$points[-1])
# Tần số
lt2$categories <- cut(lt2$data, lt2$points, right = FALSE)
lt2$f <- as.vector(table(lt2$categories))
# Tần số tích lũy
lt2$cf <- cumsum(lt2$f)
# Khung dữ liệu
lt2$df <- data.frame(
    ` ` = seq(1, length(lt2$points) - 1, by = 1),
    Nhóm = c(paste0("\\(", levels(lt2$categories), "\\)")),
    `Mút trái` = seq(25, 88, by = 9),
    `Mút phải` = seq(34, 97, by = 9),
    `Giá trị đại diện` = lt2$x,
    `Tần số` = lt2$f,
    `Tần số tích lũy` = lt2$cf,
    check.names = FALSE
)

data <- data.frame(lt2$df[, c(-1, -3, -4, -5, -7), drop = FALSE], check.names = FALSE)
data <- rbind(lt2$df[, c(-1, -3, -4, -5, -7), drop = FALSE], c("", "\\(n=30\\)"))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", ";", x)
})
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

::: {.ket-thuc}
:::

</details>

<!-- Hoạt động 3 -->

<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Hoạt động 3</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Hoạt động 3}
:::

Trong *Bảng 4*, có bao nhiêu số liệu với giá trị không vượt quá giá trị đầu mút phải:

::: {.columns}
:::: {.column width="33%"}
a. 163 của nhóm 1?
b. 166 của nhóm 2?
::::
:::: {.column width="33%"}
c. 169 của nhóm 3?
d. 172 của nhóm 4?
::::
:::: {.column width="33%"}
e. 175 của nhóm 5?
::::
:::

```{r, echo = FALSE}
# Các điểm chia
hd2$points <- seq(160, 175, by = 3)
# Các giá trị đại liện
hd2$x <- .5 * (hd2$points[-length(hd2$points)] + hd2$points[-1])
# Tần số
hd2$categories <- cut(hd2$data, hd2$points, right = FALSE)
hd2$f <- as.vector(table(hd2$categories))
# Tần số tích lũy
hd2$cf <- cumsum(hd2$f)
# Khung dữ liệu
hd2$df <- data.frame(
    ` ` = seq(1, length(hd2$points) - 1, by = 1),
    `Nhóm` = c(paste0("\\(", levels(hd2$categories), "\\)")),
    `Mút trái` = hd2$points[-length(hd2$points)],
    `Mút phải` = hd2$points[-1],
    `Giá trị đại diện` = hd2$x,
    `Tần số` = hd2$f,
    `Tần số tích lũy` = hd2$cf,
    check.names = FALSE
)
data <- data.frame(hd2$df[, c(-1, -3, -4, -5, -7), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "\\(n=36\\)"))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", ";", x)
})
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA, caption = "Bảng 4") %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

</details>

<!-- lời giải Hoạt động 3 -->

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải Hoạt động 3</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

a. Nhóm 1, $[160; 163)$, có tần số là 6. Vậy có 6 số liệu không vượt quá 163.
b. Nhóm 2, $[163; 166)$, có tần số là 12. Các số liệu trong nhóm 1 cũng không vượt quá 166. Vậy tổng số là
$$
6+12=18.
$$
c. Tương tự, số số liệu không vượt quá đầu mút phải 169 của nhóm 3 là
$$
6+12+10=28.
$$
d. Số số liệu không vượt quá đầu mút phải 172 của nhóm 4 là
$$
6+12+10+5=33.
$$
e. Số số liệu không vượt quá đầu mút phải 175 của nhóm 5 là
$$
6+12+10+5+3=36.
$$

::: {.ket-thuc}
:::

::: {.callout-note title="Tần số tích lũy" appearance="simple" icon=false collapse=true}
Đáp số câu a cho biết tần số tích lũy của nhóm 1 là 6. Đáp số câu b cho biết tần số tích lũy của nhóm 2 là 18. Đáp số câu e cho biết tần số tích lũy của nhóm 5 là 36.

*Tần số tích lũy* của một nhóm là số số liệu có giá trị nhỏ hơn đầu mút phải của nhóm đó.
:::

</details>

<!-- LUYỆN TẬP  3 -->
<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Luyện tập 3</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Luyện tập 3}
:::

Trong bài toán ở Luyện tập 2, lập bảng tần số ghép nhóm bao gồm cả tần số tích lũy có tám nhóm ứng với tám nửa khoång: $[25; 34)$, $[34; 43)$, $[43; 52)$, $[52; 61)$, $[61; 70)$, $[70; 79)$, $[79 ; 88)$, $[88; 97)$.
</details>

<!-- Lời giải Luyện tập 3 -->
<details>
::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

```{r, echo = FALSE}
data <- data.frame(lt2$df[, c(-1, -3, -4, -5), drop = FALSE], check.names = FALSE)
data <- rbind(lt2$df[, c(-1, -3, -4, -5), drop = FALSE], c("", "\\(n=30\\)", ""))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", ";", x)
})
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

::: {.ket-thuc}
:::
</details>

<!-- HOẠT ĐỘNG 4 -->
<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Hoạt động 4</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Hoạt động 4}
:::

Xét mẫu số liệu được cho trong *Bảng 4*.

```{r, echo=FALSE}
data <- data.frame(hd2$df[, c(-1, -3, -4, -5, -7), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "\\(n=36\\)"))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", ";", x)
})
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA, caption = "Bảng 4") %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

a. Tìm trung điểm $x_1$ của nửa khoảng (tính bằng trung bình cộng của hai đầu mút) ứng với nhóm 1. Ta gọi trung điểm $x_1$ là *giá trị đại diện* của nhóm 1.
b. Bằng cách tương tự, hãy tìm giá trị đại diện của bốn nhóm còn lại. Từ đó, hãy hoàn thiện các số liệu trong *Bảng 7*.
c. Tính giá trị $\overline{x}$ cho bởi công thức sau:
$$
\overline{x} = \frac{n_1x_1+n_2x_2+\cdots+n_5x_5}{n}.
$$
Giá trị $\overline{x}$ được gọi là *số trung bình cộng* của muẫ số liệu đã cho.

<!-- Bảng 7 -->

```{r, echo=FALSE}
data <- data.frame(hd2$df["Nhóm"], `Giá trị đại diện`=c("\\(x_1=?\\)", "\\(x_2=?\\)", "\\(x_3=?\\)", "\\(x_4=?\\)", "\\(x_5=?\\)"), `Tần số`=c("\\(n_1=?\\)", "\\(n_2=?\\)", "\\(n_3=?\\)","\\(n_4=?\\)", "\\(n_5=?\\)"), check.names = FALSE)
data <- rbind(data, c("", "", "\\(n=36\\)"))
# Đổi dấu phẩy trong nhóm thành dấu chấm phẩy
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", ";", x)
})
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA, caption = "Bảng 7") %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

</details>

<!-- LLời giải Hoạt động 4 -->

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

a. Giá trị đại diện của nhóm 1, $[160; 163)$, là
    $$
        x_1=\frac{160+163}{2}=161,5 \text{ (cm)}.
    $$

b. Tương tự, giá trị đại diện cho các nhóm còn lại được tính như dưới đây.
    - Nhóm 2, $[163; 166)$: $x_2=\frac{163+166}{2}=164,5$ (cm).
    - Nhóm 3, $[166; 169)$: $x_3=\frac{166+169}{2}=167,5$ (cm).
    - Nhóm 4, $[169; 172)$: $x_4=\frac{169+172}{2}=170,5$ (cm).
    - Nhóm 5, $[172; 175)$: $x_5=\frac{172+175}{2}=173,5$ (cm).

c. Từ *Bảng 4* và các giá trị đại diện vừa tính, mình lập được bảng dưới đây.

```{r, echo=FALSE}
data <- data.frame(hd2$df[, c(-1, -3, -4, -7), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "", "\\(n=36\\)"))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", "TEMP_MARKER", x) # Đổi dấu ',' thành ký hiệu tạm
    x <- gsub("\\.", ",", x) # Đổi dấu '.' thành ','
    gsub("TEMP_MARKER", ";", x) # Đổi ký hiệu tạm thành ';'
})
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

<!-- Trung bình -->

```{r}
# Kích thước mẫu
hd2$n <- length(hd2$data)
hd2$barx <- fractions(sum(hd2$df$`Giá trị đại diện` * hd2$df$`Tần số`) / sum(hd2$df$`Tần số`))
```

Số trung bình cộng của mẫu số liệu đã cho là
    \begin{align*}
        \overline{x} 
            & = \frac{1}{36}(6\cdot 161,5+12\cdot 164,5+10\cdot 167,5+5\cdot170,5+3\cdot 173,5) \\
            & = \frac{1997}{12} \\
            & \approx `r format(round(as.numeric(hd2$barx), 4), decimal.mark = ",")` \text{ (cm)}.
    \end{align*}

::: {.ket-thuc}
:::

</details>

<!-- Luyện tập 4 -->

<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Luyện tập 4</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Luyện tập 4}
:::

Xác định số trung bình cộng của mẫu số liệu ghép nhóm trong bài toán ở Luyện tập 2.

</details>

<!-- Lời giải luyện tập 4 -->

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

Bảng tần số ghép nhóm và giá trị đại diện của mẫu số liệu trong bài toán ở Luyện tập 2:

```{r, echo = FALSE}
data <- data.frame(lt2$df[, c(-1, -3, -4, -7), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "", "\\(n=30\\)"))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", "TEMP_MARKER", x) # Đổi dấu ',' thành ký hiệu tạm
    x <- gsub("\\.", ",", x) # Đổi dấu '.' thành ','
    gsub("TEMP_MARKER", ";", x) # Đổi ký hiệu tạm thành ';'
})
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

```{r}
lt2$n <- length(lt2$data)
lt2$barx <- fractions(sum(lt2$df$`Giá trị đại diện` * lt2$df$`Tần số`) / sum(lt2$df$`Tần số`))
```

Trung bình cộng là
\begin{align*}
    \overline{x}
        & = \frac{1}{30}(3\cdot 29,5 + 3\cdot 38,5 + 6\cdot 47,5 + 5\cdot 56,5 + 4\cdot 65,5 + 3\cdot 74,5 + 4\cdot 83,5 + 2\cdot 92,5) \\
        & = \frac{296}{5} \\
        & = `r format(round(as.numeric(lt2$barx), 4), decimal.mark = ",")` \text{ (người)}.
\end{align*}

::: {.ket-thuc}
:::

</details>

<!-- Hoạt động 5 -->

<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Hoạt động 5</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Hoạt động 5}
:::

Trong phòng thí nghiệm, người ta chia 99 mẫu vật thành năm nhóm căn cứ trên khối lượng của chúng (đơn vị: g) và lập bảng tần số ghép nhóm bao gồm cả tần số tích luỹ như *Bảng 10*.

a. Nhóm 3 là nhóm đầu tiên có tần số tích luỹ
lớn hơn hoặc bằng 
$$
    \frac{n}{2}=\frac{99}{2}=49,5 \text{ có đúng không?}
$$
b. Tìm đầu mút trái $r$, độ dài $d$, tần số $n_3$ của nhóm 3 và tần số tích lũy $cf_2$ của nhóm 2.
c. Tính giá trị $M_e$ theo công thức sau:
$$
    M_e = r + \left (\frac{49,5-cf_2}{n_3}\right)\cdot d.
$$
Giá trị $M_e$ được gọi là *trung vị* của mẫu số liệu ghép nhóm đã cho.

```{r}
hd5 <- new.env()
hd5$df <- data.frame(
    ` ` = c(1, 2, 3, 4, 5),
    `Nhóm` = c("\\([27,5;32,5)\\)", "\\([32,5;37,5)\\)", "\\([37,5;42,5)\\)", "\\([42,5;47,5)\\)", "\\([47,5;52,5)\\)"),
    `Mút trái` = seq(27.5, 47.5, by = 5),
    `Mút phải` = seq(32.5, 52.5, by = 5),
    `Giá trị đại diện` = .5 * (seq(27.5, 47.5, by = 5) + seq(32.5, 52.5, by = 5)),
    `Tần số` = c(16, 24, 20, 30, 9),
    `Tần số tích lũy` = cumsum(c(16, 24, 20, 30, 9)),
    check.names = FALSE
)
data <- data.frame(hd5$df[, c(-1, -3, -4, -5), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "\\(n=99\\)", ""))
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA, caption = "Bảng 10") %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

</details>

<!-- Lời giải Hoạt động 5 -->

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải Hoạt động 5</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

a. Vì $40 <details 49,5 <details 60$, trong đó 40 và 60 lần lượt là tần số tích lũy của nhóm 2 và 3, nên khẳng định nhóm 3 là nhóm đầu tiên có tần số tích lũy lớn hơn hoặc 49,5 là đúng.

b. Nhóm 3, $[37,5;42,5)$, có đầu mút trái là $r=37,5$, độ dài là $d=42,5-37,5=5$, tần số là $n_3=20$. Tần số tích lũy của nhóm 2 là $cf_2=40$.

c. Giá trị $M_e$ theo công thức là
\begin{align*}
    M_e
        & = r + \left (\frac{49,5-cf_2}{n_3}\right)\cdot d \\
        & = 37,5 + \left(\frac{49,5-40}{20}\right)\cdot 5 \\
        & = 39,875 \text{ (g)}.
\end{align*}

::: {.ket-thuc}
:::

</details>

<!-- Luyện tập 5 -->

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Luyện tập 5</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Luyện tập 5}
:::

Xác định trung vị của mẫu số liệu ghép nhóm ở *Bảng 1*.

</details>

<!-- Lời giải Luyện tập 5 -->

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải Luyện tập 5</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
    \textbf{Lời giải}
\end{center}
:::

Thêm vào *Bảng 1* cột tần số tích lũy để có bảng dưới đây.

```{r}
data <- data.frame(hd1$df[, c(-1, -3, -4, -5), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "\\(n=120\\)", ""))
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA, caption = "Bảng 1 thêm cột Tần số tích lũy") %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

Vì 
$$
    cf_2 = 42 < \frac{n}{2} = \frac{120}{2} = 60 < cf_3 = 90, 
$$
nên nhóm 3, $[8;12)$, là nhóm đầu tiên có tần số tích lũy lớn hơn hoặc bằng 60. Nóm này có đầu mút trái $r=8$, độ dài $d=4$, tần số $n_3=48$ và nhóm 2 có tần số tích lũy $cf_2 = 42$.

<!--  Trung vị -->

```{r, echo = FALSE}
# Kích thước mẫu
hd1$n <- sum(hd1$df$`Tần số`)
# Tìm nhóm trung vị
hd1$k <- which(hd1$df$`Tần số tích lũy` >= hd1$n / 2)[1] # Tìm chỉ mục (vị trí hàng) đầu tiên ([1]) trong hd1$df sao cho giá trị của cột "Tần số tích lũy" lớn hơn hoặc bằng hd1$n / 2, rồi lưu vào hd1$k.
# Mút trái nhóm trung vị
hd1$r <- hd1$df$`Mút trái`[hd1$k]
# Độ rộng nhóm
hd1$d <- hd1$df$`Mút phải`[hd1$k] - hd1$df$`Mút trái`[hd1$k]
# Tính trung vị
hd1$me <- fractions(hd1$r + ((hd1$n / 2 - ifelse(hd1$k > 1, hd1$df$`Tần số tích lũy`[hd1$k - 1], 0)) / hd1$df$`Tần số`[hd1$k]) * hd1$d)
```

Trung vị của mẫu số liệu là

\begin{align*}
    M_e
        & = r + \left ( \frac{\frac{n}{2} - cf_2}{n_3} \right )\cdot d \\
        & = 8 + \left (\frac{60 - 42}{48}\right)\cdot 4 \\
        & = \frac{19}{2} \\
        & = `r format(round(as.numeric(hd1$me), 4), decimal.mark = ",")` \text{ (năm)}.
\end{align*}

::: {.ket-thuc}
:::

</details>

<!-- Hoạt động 6 -->

<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Hoạt động 6</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Hoạt động 6}
:::

Giáo viên chủ nhiệm chia thời gian sử dụng Internet trong một ngày của 40 học sinh thành năm nhóm (đơn vị: phút) và lập bảng tần số ghép nhóm bao gồm cả tần số tích luỹ như *Bảng 12.*

a. Tìm trung vị $M_e$ của mẩu số liệu ghép nhóm đó. Trung vị $M_e$ còn gọi là tứ phân vị thứ hai $Q_2$ của mẫu số liệu trên.

b. Nhóm 2 là nhóm đầu tiên có tần số tích lũy lớn hơn hoặc bằng 
$$
    \frac{n}{4} = \frac{40}{4} = 10 \text{ có đúng không?}
$$
Tìm đầu mút trái $s$, độ dài $h$, tần số $n_2$ của nhóm 2 và tần số tích lũy $cf_1$ của nhóm 1. Sau đó, hãy tính giá trị $Q_1$ theo công thức sau:
$$
    Q_1 = s + \left (\frac{10-cf_1}{n_2}\right)\cdot h.
$$
Giá trị nói trên được gọi là *tứ phân vị thứ nhất* $Q_1$ của mẫu số liệu đã cho.

c. Nhóm 3 là nhóm đầu tiên có tần số tích lũy lớn hơn hoặc bằng 
$$
    \frac{3n}{4} = \frac{3\cdot 40}{4} = 30 \text{ có đúng không?}
$$
Tìm đầu mút trái $t$, độ dài $l$, tần số $n_3$ của nhóm 3 và tần số tích lũy $cf_2$ của nhóm 2. Sau đó, hãy tính giá trị $Q_3$ theo công thức sau:
$$
    Q_3 = t + \left (\frac{30-cf_2}{n_3}\right)\cdot l.
$$
Giá trị nói trên được gọi là *tứ phân vị thứ ba* $Q_3$ của mẫu số liệu đã cho.

<!-- Khung dữ liệu Hoạt động 6 -->

```{r}
hd6 <- new.env()
hd6$df <- data.frame(
    ` ` = c(1, 2, 3, 4, 5),
    `Nhóm` = c("\\([0;60)\\)", "\\([60;120)\\)", "\\([120;180)\\)", "\\([180;240)\\)", "\\([240;300)\\)"),
    `Mút trái` = seq(0, 240, by = 60),
    `Mút phải` = seq(60, 300, by = 60),
    `Giá trị đại diện` = .5 * (seq(0, 240, by = 60) + seq(60, 300, by = 60)),
    `Tần số` = c(6, 13, 13, 6, 2),
    `Tần số tích lũy` = cumsum(c(6, 13, 13, 6, 2)),
    check.names = FALSE
)
data <- data.frame(hd6$df[, c(-1, -3, -4, -5), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "\\(n=40\\)", ""))
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA, caption = "Bảng 12") %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

</details>

<!-- Lời giải Hoạt động 6 -->

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải Hoạt động 6</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::
a. Quan sát từ cột tần số tích lũy, 
$$
    19 < \frac{n}{2} = \frac{40}{2} = 20 < 32,
$$
rút ra nhóm 3, $[120; 180)$, là nhóm đầu tiên có tần số tích lũy lớn hơn 20. Nhóm này có đầu mút trái $r=120$, độ dài $d=60$, tần số $n_3=13$ và nhóm 2 có tần số tích lũy $cf_2 = 19$. 

<!-- Trung vị Hoạt động 6 -->

```{r, echo = FALSE}
hd6$n <- sum(hd6$df$`Tần số`)
hd6$k <- which(hd6$df$`Tần số tích lũy` >= hd6$n / 2)[1] 
hd6$r <- hd6$df$`Mút trái`[hd6$k]
hd6$d <- hd6$df$`Mút phải`[hd6$k] - hd6$df$`Mút trái`[hd6$k]
# Tính trung vị
hd6$me <- fractions(hd6$r + ((hd6$n / 2 - ifelse(hd6$k > 1, hd6$df$`Tần số tích lũy`[hd6$k - 1], 0)) / hd6$df$`Tần số`[hd6$k]) * hd6$d)
# hd6$me
```

Trung vị $M_e$ hay tứ phân vị thứ hai $Q_2$ là
\begin{align*}
    M_e = Q_2
        & = r + \left( \frac{\frac{n}{2} - cf_2}{n_3}\right)\cdot d \\
        & = 120 + \left( \frac{20-19}{13}\right)\cdot 60 \\
        & = \frac{1620}{13} \\
        & = `r format(round(as.numeric(hd6$me), 4), decimal.mark = ",")` \text{ (phút).}
\end{align*}

b. Quan sát từ cột tần số tích lũy, 
$$
    6 < \frac{n}{4} = \frac{40}{4} = 10 < 19,
$$
nên khẳng định nhóm 2 là nhóm đầu tiên có tần số tích lũy lớn hơn hoặc bằng 10 là khẳng định đúng. Nhóm 2, $[60; 120)$, có đầu mút trái $s=60$, độ dài $h=60$, tần số $n_2=13$ và nhóm 1 có tần số tích lũy $cf_1 = 6$. 

<!-- Tứ phân vị thứ nhất Q1 -->

```{r}
# Tìm nhóm tứ phân vị thứ nhất
hd6$p <- which(hd6$df$`Tần số tích lũy` >= hd6$n / 4)[1]
# Mút trái nhóm tứ phân vị thứ nhất
hd6$s <- hd6$df$`Mút trái`[hd6$p]
# Độ rộng nhóm tứ phân vị thứ nhất
hd6$h <- hd6$df$`Mút phải`[hd6$p] - hd6$df$`Mút trái`[hd6$p]
# Tính tứ phân vị thứ nhất
hd6$q1 <- fractions(hd6$s + ((hd6$n / 4 - ifelse(hd6$p > 1, hd6$df$`Tần số tích lũy`[hd6$p - 1], 0)) / hd6$df$`Tần số`[hd6$p]) * hd6$h)
# hd6$q1
```

Tứ phân vị thứ nhất là 
\begin{align*}
    Q_1 
        & = s + \left (\frac{10-cf_1}{n_2}\right)\cdot h \\
        & = 60 + \left(\frac{10-6}{13}\right)\cdot 60 \\
        & = \frac{1020}{13} \\
        & = `r format(round(as.numeric(hd6$q1), 4), decimal.mark = ",")` \text{ (phút).}
\end{align*}

c. Quan sát từ cột tần số tích lũy, 
$$
    19 < \frac{n}{4} = \frac{3\cdot 40}{4} = 30 < 32,
$$
nên khẳng định nhóm 3 là nhóm đầu tiên có tần số tích lũy lớn hơn hoặc bằng 30 là khẳng định đúng. Nhóm 3, $[120;180)$, có đầu mút trái $t=120$, độ dài $l=60$, tần số $n_3=13$ và nhóm 2 có tần số tích lũy $cf_2 = 19$. 

<!-- Tứ phân vị thứ nhất Q3 -->

```{r, echo = FALSE}
# Tìm nhóm tứ phân vị thứ ba
hd6$q <- which(hd6$df$`Tần số tích lũy` >= (3 * hd6$n) / 4)[1]
# Mút trái nhóm tứ phân vị thứ ba
hd6$t <- hd6$df$`Mút trái`[hd6$q]
# Độ rộng nhóm tứ phân vị thứ ba
hd6$l <- hd6$df$`Mút phải`[hd6$q] - hd6$df$`Mút trái`[hd6$q]
# Tính tứ phân vị thứ ba
hd6$q3 <- fractions(hd6$t + (((3 * hd6$n) / 4 - ifelse(hd6$q > 1, hd6$df$`Tần số tích lũy`[hd6$q - 1], 0)) / hd6$df$`Tần số`[hd6$q]) * hd6$h)
# hd6$q3
```

Tứ phân vị thứ ba là 
\begin{align*}
    Q_3 
        & = t + \left (\frac{30-cf_2}{n_3}\right)\cdot l \\
        & = 120 + \left(\frac{30-19}{13}\right)\cdot 60 \\
        & = \frac{2220}{13} \\
        & = `r format(round(as.numeric(hd6$q3), 4), decimal.mark = ",")` \text{ (phút).}
\end{align*}

::: {.ket-thuc}
:::

</details>

<!-- Luyện tập 6 -->

<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Luyện tập 6</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Luyện tập 6}
:::

Tìm tứ phân vị của mẫu số liệu trong *Bảng 1* (làm tròn các kết quả đến hàng phần mười).

</details>

<!-- Lời giải Luyện tập 6 -->

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải Luyện tập 6</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

*Bảng 1* thêm vào cột Tần số tích lũy:

```{r}
data <- data.frame(hd1$df[, c(-1, -3, -4, -5), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "\\(n=120\\)", ""))
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

<!-- Tứ phân vị thứ nhất Q1 -->

- Quan sát từ cột tần số tích lũy, 
$$
    13 < \frac{n}{4} = \frac{120}{4} = 30 < 42,
$$
nên nhóm 2 là nhóm đầu tiên có tần số tích lũy lớn hơn 30. Nhóm 2, $[60; 120)$, có đầu mút trái $s=4$, độ dài $h=4$, tần số $n_2=29$ và nhóm 1 có tần số tích lũy $cf_1 = 13$. 

```{r}
# Tìm nhóm tứ phân vị thứ nhất
hd1$p <- which(hd1$df$`Tần số tích lũy` >= hd1$n / 4)[1]
# Mút trái nhóm tứ phân vị thứ nhất
hd1$s <- hd1$df$`Mút trái`[hd1$p]
# Độ rộng nhóm tứ phân vị thứ nhất
hd1$h <- hd1$df$`Mút phải`[hd1$p] - hd1$df$`Mút trái`[hd1$p]
# Tính tứ phân vị thứ nhất
hd1$q1 <- fractions(hd1$s + ((hd1$n / 4 - ifelse(hd1$p > 1, hd1$df$`Tần số tích lũy`[hd1$p - 1], 0)) / hd1$df$`Tần số`[hd1$p]) * hd1$h)
# hd1$q1
```

Tứ phân vị thứ nhất là 
\begin{align*}
    Q_1 
        & = 4 + \left (\frac{30-13}{29}\right)\cdot 4 \\
        & = \frac{184}{29} \\
        & \approx `r format(round(as.numeric(hd1$q1), 0), decimal.mark = ",")` \text{ (năm).}
\end{align*}

- Quan sát từ cột tần số tích lũy, 
$$
    42 < \frac{n}{2} = \frac{120}{2} = 60 < 90,
$$
rút ra nhóm 3 là nhóm đầu tiên có tần số tích lũy lớn hơn 60. Nhóm 3, $[8; 12)$, có đầu mút trái $r=8$, độ dài $d=4$, tần số $n_3=48$ và nhóm 2 có tần số tích lũy $cf_2 = 42$. 

<!-- Trung vị Hoạt động 6 -->

```{r, echo = FALSE}
hd1$n <- sum(hd1$df$`Tần số`)
hd1$k <- which(hd1$df$`Tần số tích lũy` >= hd1$n / 2)[1] 
hd1$r <- hd1$df$`Mút trái`[hd1$k]
hd1$d <- hd1$df$`Mút phải`[hd1$k] - hd1$df$`Mút trái`[hd1$k]
# Tính trung vị
hd1$me <- fractions(hd1$r + ((hd1$n / 2 - ifelse(hd1$k > 1, hd1$df$`Tần số tích lũy`[hd1$k - 1], 0)) / hd1$df$`Tần số`[hd1$k]) * hd1$d)
# hd1$me
```

Tứ phân vị thứ hai là
\begin{align*}
    Q_2
        & = 8 + \left( \frac{60-42}{48}\right)\cdot 4 \\
        & = \frac{19}{2} \\
        & \approx `r format(round(as.numeric(hd1$me), 0), decimal.mark = ",")` \text{ (năm).}
\end{align*}

- Quan sát từ cột tần số tích lũy, 
$$
    42 < \frac{n}{4} = \frac{3\cdot 120}{4} = 90,
$$
nên nhóm 3, $[8;12)$, là nhóm đầu tiên có tần số tích lũy bằng 90.

<!-- Tứ phân vị thứ nhất Q3 -->

```{r, echo = FALSE}
# Tìm nhóm tứ phân vị thứ ba
hd1$q <- which(hd1$df$`Tần số tích lũy` >= (3 * hd1$n) / 4)[1]
# Mút trái nhóm tứ phân vị thứ ba
hd1$t <- hd1$df$`Mút trái`[hd1$q]
# Độ rộng nhóm tứ phân vị thứ ba
hd1$l <- hd1$df$`Mút phải`[hd1$q] - hd1$df$`Mút trái`[hd1$q]
# Tính tứ phân vị thứ ba
hd1$q3 <- fractions(hd1$t + (((3 * hd1$n) / 4 - ifelse(hd1$q > 1, hd1$df$`Tần số tích lũy`[hd1$q - 1], 0)) / hd1$df$`Tần số`[hd1$q]) * hd1$h)
# hd1$q3
```

Tứ phân vị thứ ba là 
\begin{align*}
    Q_3
        & = 8 + \left(\frac{90-42}{48}\right)\cdot 4 \\
        & = `r format(round(as.numeric(hd1$q3), 0), decimal.mark = ",")` \text{ (năm).}
\end{align*} 

::: {.ket-thuc}
:::

</details>

<!-- Hoạt động 7 -->

<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Hoạt động 7</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Hoạt động 7}
:::

Quan sát bảng tần số ghép nhóm bao gồm cả tần số tích luỹ ở *Ví dụ 6* và cho biết:

a. Nhóm nào có tần số lớn nhất;
b. Đầu mút trái và độ dài của nhóm có tần số lớn nhất bằng bao nhiêu.

</details>

<!-- Lời giải Hoạt động 7 -->

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải Hoạt động 7</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

Bảng tần số ghép nhóm bao gồm cả tần số tích luỹ ở *Ví dụ 6* được trình bày như dưới đây.

```{r}
hd7 <- new.env()
hd7$df <- data.frame(
    ` ` = c(1, 2, 3, 4, 5, 6),
    `Nhóm` = c("\\([30;40)\\)", "\\([40;50)\\)", "\\([50;60)\\)", "\\([60;70)\\)", "\\([70;80)\\)", "\\([80;90)\\)"),
    `Mút trái` = seq(30, 80, by = 10),
    `Mút phải` = seq(40, 90, by = 10),
    `Giá trị đại diện` = .5 * (seq(30, 80, by = 10) + seq(40, 90, by = 10)),
    `Tần số` = c(2, 10, 16, 8, 2, 2),
    `Tần số tích lũy` = cumsum(c(2, 10, 16, 8, 2, 2)),
    check.names = FALSE
)
data <- data.frame(hd7$df[, c(-1, -3, -4, -5), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "\\(n=40\\)", ""))
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA, caption = "Bảng 15") %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

a. Nhóm 3, $[50; 60)$, có tần số lớn nhất 16.
b. Nhóm 3 có dầu mút trái 50 và độ dài 10.

</details>

<!-- Luyện tập 7 -->

<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Luyện tập 7</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Luyện tập 7}
:::

Tìm mốt của mẫu số liệu trong *Ví dụ 6* (làm tròn các kết quả đến hàng
phần mười). 

</details>

<!-- Lời giải Luyện tập 7 -->

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải Luyện tập 7</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

Bảng tần số ghép nhóm của mẫu số liệu *Ví dụ 6* được trình bày dưới đây.

```{r}
hd7 <- new.env()
hd7$df <- data.frame(
    ` ` = c(1, 2, 3, 4, 5, 6),
    `Nhóm` = c("\\([30;40)\\)", "\\([40;50)\\)", "\\([50;60)\\)", "\\([60;70)\\)", "\\([70;80)\\)", "\\([80;90)\\)"),
    `Mút trái` = seq(30, 80, by = 10),
    `Mút phải` = seq(40, 90, by = 10),
    `Giá trị đại diện` = .5 * (seq(30, 80, by = 10) + seq(40, 90, by = 10)),
    `Tần số` = c(2, 10, 16, 8, 2, 2),
    `Tần số tích lũy` = cumsum(c(2, 10, 16, 8, 2, 2)),
    check.names = FALSE
)
data <- data.frame(hd7$df[, c(-1, -3, -4, -5, -7), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "\\(n=40\\)"))
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

Quan sát cột tần số, nhóm 3, $[50;60)$, là nhóm có tần số lớn nhất $n_3=16$, có đầu mút trái $u=50$ và độ dài $g=10$. Nhóm 2 có tần số $n_2=10$ và nhóm 4 có tần số $n_4=8$. 

<!-- Mốt -->

```{r}
# Tìm nhóm có tần số lớn nhất
hd7$i <- which.max(hd7$df$`Tần số`)
# Mút trái của nhóm mốt
hd7$u <- hd7$df$`Mút trái`[hd7$i]
# Độ rộng nhóm mốt
hd7$g <- hd7$df$`Mút phải`[hd7$i] - hd7$df$`Mút trái`[hd7$i]
# Tính mốt
hd7$mo <- fractions(hd7$u + ((hd7$df$`Tần số`[hd7$i] - ifelse(hd7$i > 1, hd7$df$`Tần số`[hd7$i - 1], 0)) / (2 * hd7$df$`Tần số`[hd7$i] - ifelse(hd7$i > 1, hd7$df$`Tần số`[hd7$i - 1]) - ifelse(hd7$i < nrow(hd7$df), hd7$df$`Tần số`[hd7$i + 1], 0))) * hd7$g, 4)
# hd7$mo
```

Mốt là
\begin{align*}
    M_o
        & = u + \left(\frac{n_3-n_2}{2n_3-n_2-n_4}\right)\cdot g \\
        & = 50 + \left(\frac{16-10}{2\cdot 16-10-8}\right)\cdot 10 \\
        & = \frac{380}{7} \\
        & = `r format(round(as.numeric(hd7$mo), 1), decimal.mark = ",")` \text{ (kg).}
\end{align*}

::: {.ket-thuc}
:::

</details>

<!-- Bài tập 1 -->

<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Bài tập 1</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Bài tập 1}
:::

Mẫu số liệu dưới đây ghi lại tốc độ của 40 ô-tô khi đi qua một trạm đo tốc độ (đơn vị: km/h):

<!-- DỮ LIỆU -->
```{r, echo = FALSE}
bai1 <- new.env()
# Tạo dữ liệu
bai1$data <- c(48.5, 43, 50, 55, 45, 60, 53, 55.5, 44, 65, 51, 62.5, 41, 44.5, 57, 57, 68, 49, 46.5, 53.5, 61, 49.5, 54, 62, 59, 56, 47, 50, 60, 61, 49.5, 52.5, 57, 47, 60, 55, 45, 47.5, 48, 61.5)
data <- matrix(bai1$data, nrow = 4, byrow = TRUE)
# Định dạng số thập phân: thay dấu "." bằng ","
data <- format(data, decimal.mark = ",")
# Bảng
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA) %>%
        kable_styling(latex_options = "hold_position")
}
```

a. Lập bảng tần số ghép nhóm cho mẫu số liệu trên có sáu nhóm ứng với sáu nửa khoảng:

::: {.content-visible when-format="html"}
<div style="text-align: center;">
$[40; 45)$, $[45 ; 50)$, $[50; 55)$, $[55 ; 60)$, $[60; 65)$, $[65; 70)$.
</div>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
$[40; 45)$, $[45 ; 50)$, $[50; 55)$, $[55 ; 60)$, $[60; 65)$, $[65; 70)$.
\end{center}
:::

b. Xác định trung bình cộng, trung vị, tứ phân vị của mẫu số liệu ghép nhóm trên.

c.  Mốt của mẫu số liệu ghép nhóm trên là bao nhiêu?
</details>

<!-- LỜI GIẢI BÀI TẬP 1 -->
<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

<!-- KHUNG DỮ LIỆU -->
```{r, echo=FALSE}
# Các điểm chia
bai1$points <- seq(40, 70, by = 5)
# Các giá trị đại liện
bai1$x <- .5 * (bai1$points[-length(bai1$points)] + bai1$points[-1])
# Tần số
bai1$categories <- cut(bai1$data, bai1$points, right = FALSE)
bai1$f <- as.vector(table(bai1$categories))
# Tần số tích lũy
bai1$cf <- cumsum(bai1$f)
# Khung dữ liệu
bai1$df <- data.frame(
    ` ` = seq(1, length(bai1$points) - 1, by = 1),
    Nhóm = c(paste0("\\(", levels(bai1$categories), "\\)")),
    `Mút trái` = seq(40, 65, by = 5),
    `Mút phải` = seq(45, 70, by = 5),
    `Giá trị đại diện` = bai1$x,
    `Tần số` = bai1$f,
    `Tần số tích lũy` = bai1$cf,
    check.names = FALSE
)
```

a. Để đảm bảo phân nhóm chính xác, trước tiên mình sắp xếp số liệu theo thứ tự tăng dần. 

<!-- SẮP XẾP SỐ LIỆU TĂNG DẦN -->
```{r, echo=FALSE}
data <- format(matrix(sort(bai1$data), nrow = 4, byrow = TRUE), decimal.mark = ",")
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

Nhìn vào dãy có thứ tự tăng dần, bạn dễ dàng thấy rằng thuộc vào nhóm $[40,45)$ có bốn số liệu bao gồm 41; 43; 44; 44,5. Hãy tiếp tục quan sát để thu được bảng tần số ghép nhóm.

<!-- BẢNG TẦN SỐ GHÉP NHÓM -->
```{r, echo = FALSE}
# data <- data.frame(bai1$df[, c(-1, -3, -4, -5, -7), drop = FALSE], check.names = FALSE)
data <- rbind(bai1$df[, c(-1, -3, -4, -5, -7), drop = FALSE], c("", "\\(n=40\\)"))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", ";", x)
})
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

b. Mình thêm vào bảng tần số ghép nhóm ở trên cột số thứ tự để dễ quan sát, cột Giá trị đại diện để tính trung bình, và cột Tần số tích lũy để tính tứ phân vị. 

<!-- BẢNG TẦN SỐ GHÉP NHÓM MỞ RỘNG -->
```{r, echo = FALSE}
data <- rbind(bai1$df[, c(-3, -4), drop = FALSE], c("", "", "", "\\(n=40\\)", ""))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", "TEMP_MARKER", x) # Đổi dấu ',' thành ký hiệu tạm
    x <- gsub("\\.", ",", x) # Đổi dấu '.' thành ','
    gsub("TEMP_MARKER", ";", x) # Đổi ký hiệu tạm thành ';'
})
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}

```

<!-- TRUNG BÌNH -->
```{r, echo = FALSE}
# Kích thước mẫu
bai1$n <- length(bai1$data)
bai1$barx <- fractions(sum(bai1$df$`Giá trị đại diện` * bai1$df$`Tần số`) / sum(bai1$df$`Tần số`))
```

- Mẫu có $n=40$ số liệu. Nhóm một, $[40;45)$, có trung điểm $x_1=42,5$ làm giá trị đại diện và có tần số $n_1=4$. Ký hiệu tương tự cho các nhóm còn lại. Trung bình cộng là
\begin{align*}
    \overline{x} 
        & = \frac{1}{n} (n_1\cdot x_1 + n_2\cdot x_2 + n_3\cdot x_3 + n_4\cdot x_4 + n_5\cdot x_5 + n_6\cdot x_6) \\
        & = \frac{1}{40} (4\cdot 42,5 + 11\cdot 47,5 + 7\cdot 52,5 + 8\cdot 57,5 + 8\cdot 62,5 + 2\cdot 67,5) \\
        & = \frac{431}{8} \\
        & = `r format(round(as.numeric(bai1$barx), 4), decimal.mark = ",")` \text{ (km/h)}.
\end{align*}

<!-- TRUNG VỊ -->
```{r, echo = FALSE}
# Tìm nhóm trung vị
bai1$k <- which(bai1$df$`Tần số tích lũy` >= bai1$n / 2)[1]
# Mút trái nhóm trung vị
bai1$r <- bai1$df$`Mút trái`[bai1$k]
# Độ rộng nhóm
bai1$d <- bai1$df$`Mút phải`[bai1$k] - bai1$df$`Mút trái`[bai1$k]
# Tính trung vị
bai1$me <- fractions(bai1$r + ((bai1$n / 2 - ifelse(bai1$k > 1, bai1$df$`Tần số tích lũy`[bai1$k - 1], 0)) / bai1$df$`Tần số`[bai1$k]) * bai1$d)
```

- Nhóm ba, $[50;55)$, là nhóm đầu tiên có tần số tích lũy $cf_3=22$ không nhỏ hơn $\frac{n}{2}=20$. Nhóm này có đầu mút trái $r=50$, độ dài $d=5$ và tần số $n_3=7$. Nhóm hai có tần số tích lũy $cf_2=15$. Trung vị là
    \begin{align*}
        M_e
            & = r+\left(\frac{\frac{n}{2}-cf_2}{n_3}\right)\cdot d \\
            & = 50 + \left(\frac{20-15}{7}\right)\cdot 5 \\
            & = \frac{375}{7} \\
            & \approx `r format(round(as.numeric(bai1$me), 4), decimal.mark = ",")` \text{ (km/h).}
    \end{align*}

<!-- TỨ PHÂN VỊ THỨ NHẤT -->
```{r, echo = FALSE}
bai1$p <- which(bai1$df$`Tần số tích lũy` >= bai1$n / 4)[1]
# Mút trái nhóm tứ phân vị thứ nhất
bai1$s <- bai1$df$`Mút trái`[bai1$p]
# Độ rộng nhóm tứ phân vị thứ nhất
bai1$h <- bai1$df$`Mút phải`[bai1$p] - bai1$df$`Mút trái`[bai1$p]
# Tính tứ phân vị thứ nhất
bai1$q1 <- fractions(bai1$s + ((bai1$n / 4 - ifelse(bai1$p > 1, bai1$df$`Tần số tích lũy`[bai1$p - 1], 0)) / bai1$df$`Tần số`[bai1$p]) * bai1$h)
```

- Nhóm hai, $[45;50)$, là nhóm đầu tiên có tần số tích lũy $cf_2=15$ không nhỏ hơn $\frac{n}{4}=10$. Nhóm này có đầu mút trái $s=45$, độ dài $h=5$ và tần số $n_2=11$. Nhóm một có tần số tích lũy là $cf_1=4$. Tứ phân vị thứ nhất là
    \begin{align*}
        Q_1
            & = s + \left( \frac{\frac{n}{4}-cf_1}{n_2}\right)\cdot h \\
            & = 45 + \left(\frac{10-4}{11}\right)\cdot 5 \\
            & = \frac{525}{11} \\
            & \approx `r format(round(as.numeric(bai1$q1), 4), decimal.mark = ",")` \text{ (km/h).}
    \end{align*}

- Tứ phân vị thứ hai $Q_2$ chính là trung vị $M_e$, hay $Q_2 = M_e = `r format(round(as.numeric(bai1$me), 4), decimal.mark = ",")`$ (km/h).

<!-- TỨ PHÂN VỊ THỨ BA -->
```{r, echo = FALSE}
# Tìm nhóm tứ phân vị thứ ba
bai1$q <- which(bai1$df$`Tần số tích lũy` >= (3 * bai1$n) / 4)[1]
# Mút trái nhóm tứ phân vị thứ ba
bai1$t <- bai1$df$`Mút trái`[bai1$q]
# Độ rộng nhóm tứ phân vị thứ ba
bai1$l <- bai1$df$`Mút phải`[bai1$q] - bai1$df$`Mút trái`[bai1$q]
# Tính tứ phân vị thứ ba
bai1$q3 <- fractions(bai1$t + (((3 * bai1$n) / 4 - ifelse(bai1$q > 1, bai1$df$`Tần số tích lũy`[bai1$q - 1], 0)) / bai1$df$`Tần số`[bai1$q]) * bai1$l)
```

- Nhóm bốn, $[55;60)$, là nhóm đầu tiên có tần số tích lũy $cf_4=30$ bằng với $\frac{3n}{4}=\frac{3\cdot 40}{4}=30$. Nhóm này có đầu mút trái $t=55$, độ dài $l=5$ và tần số $n_4=8$. Nhóm thứ ba có tần số tích lũy là $cf_3=22$. Tứ phân vị thứ ba là
    \begin{align*}
        Q_3
            & = t + \left(\frac{\frac{3n}{4}-cf_3}{n_4}\right)\cdot l \\
            & = 55 + \left(\frac{30-22}{8}\right)\cdot 5 \\
            & = `r format(round(as.numeric(bai1$q3), 4), decimal.mark = ",")` \text{ (km/h).}
    \end{align*}

<!-- MỐT -->
```{r, echo = FALSE}
# Tìm nhóm có tần số lớn nhất
bai1$i <- which.max(bai1$df$`Tần số`)
# Mút trái của nhóm mốt
bai1$u <- bai1$df$`Mút trái`[bai1$i]
# Độ rộng nhóm mốt
bai1$g <- bai1$df$`Mút phải`[bai1$i] - bai1$df$`Mút trái`[bai1$i]
# Tính mốt
bai1$mo <- fractions(bai1$u + ((bai1$df$`Tần số`[bai1$i] - ifelse(bai1$i > 1, bai1$df$`Tần số`[bai1$i - 1], 0)) / (2 * bai1$df$`Tần số`[bai1$i] - ifelse(bai1$i > 1, bai1$df$`Tần số`[bai1$i - 1]) - ifelse(bai1$i < nrow(bai1$df), bai1$df$`Tần số`[bai1$i + 1], 0))) * bai1$g)
```

c. Nhóm hai, $[45;50)$, là nhóm có tần số lớn nhất $n_2=11$. Nó có đầu mút trái $u=45$ và độ dài $g=5$. Nhóm một có tần số $n_1=4$ và nhóm ba có tần số $n_3=7$. Mốt là
    \begin{align*}
        M_o
            & = u + \left(\frac{n_2-n_1}{2n_2-n_1-n_3}\right) \cdot g \\
            & = 45 + \left(\frac{11-4}{2\cdot 11-4-7}\right)\cdot 5 \\
            & = \frac{530}{11} \\
            & \approx `r format(round(as.numeric(bai1$mo), 4), decimal.mark = ",")` \text{ (km/h)}.
    \end{align*}

::: {.content-visible when-format="pdf"}
Tóm lại, bảng tần số ghép nhóm là
\begin{center}
\centering
\begin{tabular}{|c|c|c|c|c|c|}
\hline 
$[40; 45)$ & $[45 ; 50)$ & $[50; 55)$ & $[55 ; 60)$ & $[60; 65)$ & $[65; 70)$ \\
\hline 
4 & 11 & 7 & 8 & 8 & 2. \\
\hline
\end{tabular}
\end{center}

Các số đặc trưng đo xu thế trung tâm là
\begin{center}
\begin{tabular}{|c|c|c|c|c|}
\hline
$\overline{x}$ & $Q_1$ & $Q_2$ ($M_e$) & $Q_3$ & $M_o$ \\
\hline
`r format(round(as.numeric(bai1$barx), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai1$q1), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai1$me), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai1$q3), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai1$mo), 4), decimal.mark = ",")`. \\
\hline 
\end{tabular}
\end{center}
:::

::: {.ket-thuc}
:::
</details>

<!-- ĐÁP ÁN BÀI TẬP 1 -->
<details>

::: {.content-visible when-format="html"}
<summary class="dap-an">Đáp án</summary>
:::

```{r, echo = FALSE}
data <- rbind(bai1$df[, c(-3, -4), drop = FALSE], c("", "", "", "\\(n=40\\)", ""))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", "TEMP_MARKER", x) # Đổi dấu ',' thành ký hiệu tạm
    x <- gsub("\\.", ",", x) # Đổi dấu '.' thành ','
    gsub("TEMP_MARKER", ";", x) # Đổi ký hiệu tạm thành ';'
})
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = FALSE)
}
```

```{r, echo = FALSE}
# Tạo khung dữ liệu với một hàng duy nhất
data <- data.frame(
    `\\(\\overline{x}\\)` = format(round(as.numeric(bai1$barx), 4), decimal.mark = ","),
    `\\(Q_1\\)` = format(round(as.numeric(bai1$q1), 4), decimal.mark = ","),
    `\\(Q_2\\) (\\(M_e\\))` = format(round(as.numeric(bai1$me), 4), decimal.mark = ","),
    `\\(Q_3\\)` = format(round(as.numeric(bai1$q3), 4), decimal.mark = ","),
    `\\(M_o\\)` = format(round(as.numeric(bai1$mo), 4), decimal.mark = ","),
    check.names = FALSE
)
# Kiểm tra định dạng đầu ra
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
# Hiển thị bảng nếu định dạng đầu ra là HTML
if (output_format == "html") {
    knitr::kable(data, align = "c", format = "html") %>%
        kableExtra::kable_styling(
            bootstrap_options = c("striped", "hover", "condensed", "responsive"),
            full_width = FALSE
        )
}
```

</details>

<!-------------------------------------------------------------------->

<!-- BÀI TẬP 2 -->
<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Bài tập 2</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Bài tập 2}
:::

Mẫu số liệu sau ghi lại cân nặng của 30 bạn học sinh (đơn vị: kg):

<!-- DỮ LIỆU -->
```{r, echo = FALSE}
bai2 <- new.env()
# Tạo dữ liệu
bai2$data <- c(17.0, 40.0, 39.0, 40.5, 42.0, 51.0, 41.5, 39.0, 41.0, 30.0, 40.0, 42.0, 40.5, 39.5, 41.0, 40.5, 37.0, 39.5, 40.0, 41.0, 38.5, 39.5, 40.0, 41.0, 39.0, 40.5, 40.0, 38.5, 39.5, 41.5)
data <- matrix(bai2$data, nrow = 3, byrow = TRUE)
# Định dạng số thập phân: thay dấu "." bằng ","
data <- format(data, decimal.mark = ",")
# Bảng
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

a. Lập bảng tần số ghép nhóm cho mẫu số liệu trên có tám nhóm ứng với tám nửa khoảng:

::: {.content-visible when-format="html"}
<div style="text-align: center;">
$[15; 20)$, $[20; 25)$, $[25; 30)$, $[30; 35)$, $[35; 40)$, $[40 ; 45)$, $[45; 50)$, $[50; 55)$.
</div>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
$[15; 20)$, $[20; 25)$, $[25; 30)$, $[30; 35)$, $[35; 40)$, $[40 ; 45)$, $[45; 50)$, $[50; 55)$.
\end{center}
:::

b. Xác định trung bình cộng, trung vị, tứ phân vị của mẫu số liệu ghép nhóm trên.

c. Mốt của mẫu số liệu ghép nhóm trên là bao nhiêu?
</details>

<!-- LỜI GIẢI BÀI TẬP 2 -->
<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

<!-- KHUNG DỮ LIỆU -->
```{r, echo=FALSE}
# Các điểm chia
bai2$points <- seq(15, 55, by = 5)
# Các giá trị đại liện
bai2$x <- .5 * (bai2$points[-length(bai2$points)] + bai2$points[-1])
# Tần số
bai2$categories <- cut(bai2$data, bai2$points, right = FALSE)
bai2$f <- as.vector(table(bai2$categories))
# Tần số tích lũy
bai2$cf <- cumsum(bai2$f)
# Khung dữ liệu
bai2$df <- data.frame(
    ` ` = seq(1, length(bai2$points) - 1, by = 1),
    Nhóm = c(paste0("\\(", levels(bai2$categories), "\\)")),
    `Mút trái` = seq(15, 50, by = 5),
    `Mút phải` = seq(20, 55, by = 5),
    `Giá trị đại diện` = bai2$x,
    `Tần số` = bai2$f,
    `Tần số tích lũy` = bai2$cf,
    check.names = FALSE
)
```

a. Để đảm bảo phân nhóm chính xác, trước tiên mình sắp xếp số liệu theo thứ tự tăng dần. 

<!-- Sắp xếp số liệu tăng dần -->
```{r, echo=FALSE}
data <- format(matrix(sort(bai2$data), nrow = 3, byrow = TRUE), decimal.mark = ",")
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data,
        format = "html",
        align = "c", col.names = NA
    ) %>%
        kable_styling(
            bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE
        )
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

Nhìn vào dãy có thứ tự tăng dần, bạn dễ dàng thấy rằng thuộc vào nhóm $[15,20)$ chỉ có một số liệu là 17. Hãy tiếp tục quan sát để thu được bảng tần số ghép nhóm.

<!-- BẢNG TẦN SỐ GHÉP NHÓM -->
```{r, echo = FALSE}
data <- rbind(bai2$df[, c(-1, -3, -4, -5, -7), drop = FALSE], c("", "\\(n=40\\)"))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", ";", x)
})
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

b. Mình thêm vào bảng tần số ghép nhóm ở trên cột số thứ tự để dễ quan sát, cột Giá trị đại diện để tính trung bình, và cột Tần số tích lũy để tính tứ phân vị.

<!-- BẢNG TẦN SỐ GHÉP NHÓM MỞ RỘNG -->
```{r, echo = FALSE}
data <- rbind(bai2$df[, c(-3, -4), drop = FALSE], c("", "", "", "\\(n=40\\)", ""))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", "TEMP_MARKER", x) # Đổi dấu ',' thành ký hiệu tạm
    x <- gsub("\\.", ",", x) # Đổi dấu '.' thành ','
    gsub("TEMP_MARKER", ";", x) # Đổi ký hiệu tạm thành ';'
})
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

<!-- TRUNG BÌNH -->
```{r, echo = FALSE}
# Kích thước mẫu
bai2$n <- length(bai2$data)
bai2$barx <- fractions(sum(bai2$df$`Giá trị đại diện` * bai2$df$`Tần số`) / sum(bai2$df$`Tần số`))
```

- Mẫu có $n=30$ số liệu. Nhóm một, $[15;20)$, có trung điểm $x_1=17,5$ làm giá trị đại diện và có tần số $n_1=1$. Ký hiệu tương tự với các nhóm còn lại. Trung bình là
\begin{align*}
\overline{x}
    & = \frac{1}{n}(n_1\cdot x_1 + n_2\cdot x_2 + n_3\cdot x_3 + n_4\cdot x_4 + n_5\cdot x_5 + n_6\cdot x_6 + n_7\cdot x_7 + n_8\cdot x_8) \\
    & = \frac{1}{30} (1\cdot 17,5 + 0\cdot 22,5 + 0\cdot 27,5+ 1\cdot 32,5 + 10\cdot 37,5 + 17\cdot 42,5 + 0\cdot 47,5 + 52,5 \cdot 1) \\
    & = `r format(round(as.numeric(bai2$barx), 4), decimal.mark = ",")` \text{ (kg).}
\end{align*}

<!-- TRUNG VỊ -->
```{r, echo = FALSE}
# Tìm nhóm trung vị
bai2$k <- which(bai2$df$`Tần số tích lũy` >= bai2$n / 2)[1]
# Mút trái nhóm trung vị
bai2$r <- bai2$df$`Mút trái`[bai2$k]
# Độ rộng nhóm
bai2$d <- bai2$df$`Mút phải`[bai2$k] - bai2$df$`Mút trái`[bai2$k]
# Tính trung vị
bai2$me <- fractions(bai2$r + ((bai2$n / 2 - ifelse(bai2$k > 1, bai2$df$`Tần số tích lũy`[bai2$k - 1], 0)) / bai2$df$`Tần số`[bai2$k]) * bai2$d)
```

- Nhóm sáu, $[40;45)$, là nhóm đầu tiên có tần số tích lũy $cf_6=29$ không nhỏ hơn $\frac{n}{2}=15$. Nhóm này có đầu mút trái $r=40$, độ dài $d=5$ và tần số $n_6=17$. Nhóm năm liền trước nó có tần số tích lũy $cf_5=12$. Trung vị là
\begin{align*}
M_e
    & = r + \left(\frac{\frac{n}{2}-cf_5}{n_6}\right)\cdot d \\
    & = 40 + \left(\frac{15-12}{17}\right)\cdot 5 \\
    & = \frac{695}{17} \\
    & \approx `r format(round(as.numeric(bai2$me), 4), decimal.mark = ",")` \text{ (kg).}
\end{align*}

<!-- Tứ phân vị thứ nhất Q1 -->

```{r, echo = FALSE}
bai2$p <- which(bai2$df$`Tần số tích lũy` >= bai2$n / 4)[1]
# Mút trái nhóm tứ phân vị thứ nhất
bai2$s <- bai2$df$`Mút trái`[bai2$p]
# Độ rộng nhóm tứ phân vị thứ nhất
bai2$h <- bai2$df$`Mút phải`[bai2$p] - bai2$df$`Mút trái`[bai2$p]
# Tính tứ phân vị thứ nhất
bai2$q1 <- fractions(bai2$s + ((bai2$n / 4 - ifelse(bai2$p > 1, bai2$df$`Tần số tích lũy`[bai2$p - 1], 0)) / bai2$df$`Tần số`[bai2$p]) * bai2$h)
```

- Nhóm năm $[35;40)$ là nhóm đầu tiên có tần số tích lũy $cf_5=12$ không nhỏ hơn $\frac{n}{4}=7,5$. Nhóm này có đầ mút trái $s=35$, độ dài $h=5$ và tần số $n_5=10$. Nhóm bốn liền trước nó có tần số tích lũy $cf_4=2$. Tứ phân vị thứ nhất là
\begin{align*}
Q_1
    & = s + \left( \frac{\frac{n}{4}-cf_4}{n_5}\right)\cdot h \\
    & = 35 + \left(\frac{7,5-2}{10}\right)\cdot 5 \\
    & = \frac{151}{4} \\
    & = `r format(round(as.numeric(bai2$q1), 4), decimal.mark = ",")` \text{ (kg).}
\end{align*}

- Tứ phân vị thứ hai $Q_2$ chính là trung vị $M_e$, hay $Q_2=M_e \approx `r format(round(as.numeric(bai2$me), 4), decimal.mark = ",")`$ (kg).

<!-- TỨ PHÂN VỊ THỨ BA -->
```{r, echo = FALSE}
# Tìm nhóm tứ phân vị thứ ba
bai2$q <- which(bai2$df$`Tần số tích lũy` >= (3 * bai2$n) / 4)[1]
# Mút trái nhóm tứ phân vị thứ ba
bai2$t <- bai2$df$`Mút trái`[bai2$q]
# Độ rộng nhóm tứ phân vị thứ ba
bai2$l <- bai2$df$`Mút phải`[bai2$q] - bai2$df$`Mút trái`[bai2$q]
# Tính tứ phân vị thứ ba
bai2$q3 <- fractions(bai2$t + (((3 * bai2$n) / 4 - ifelse(bai2$q > 1, bai2$df$`Tần số tích lũy`[bai2$q - 1], 0)) / bai2$df$`Tần số`[bai2$q]) * bai2$l)
```

- Nhóm sáu $[40;45)$ là nhòm đầu tiên có tần số tích lũy $cf_6=29$ không nhỏ hơn $\frac{3n}{4}=22,5$. Nhóm này có đầu mút trái $t=40$, độ dài $l=5$ và tần số $n_6=17$. Nhóm năm liền trước nó có tần số tích lũy là $cf_5=12$. Tứ phân vị thứ ba là
\begin{align*}
Q_3
    & = t + \left(\frac{\frac{3n}{4}-cf_5}{n_6}\right)\cdot l \\
    & = 40 +\left(\frac{22,5-12}{17}\right) \cdot 5 \\
    & = \frac{1465}{34} \\
    & \approx `r format(round(as.numeric(bai2$q3), 4), decimal.mark = ",")` \text{ (kg).} 
\end{align*}

<!-- MỐT -->
```{r, echo = FALSE}
# Tìm nhóm có tần số lớn nhất
bai2$i <- which.max(bai2$df$`Tần số`)
# Mút trái của nhóm mốt
bai2$u <- bai2$df$`Mút trái`[bai2$i]
# Độ rộng nhóm mốt
bai2$g <- bai2$df$`Mút phải`[bai2$i] - bai2$df$`Mút trái`[bai2$i]
# Tính mốt
bai2$mo <- fractions(bai2$u + ((bai2$df$`Tần số`[bai2$i] - ifelse(bai2$i > 1, bai2$df$`Tần số`[bai2$i - 1], 0)) / (2 * bai2$df$`Tần số`[bai2$i] - ifelse(bai2$i > 1, bai2$df$`Tần số`[bai2$i - 1]) - ifelse(bai2$i < nrow(bai2$df), bai2$df$`Tần số`[bai2$i + 1], 0))) * bai2$g, 4)
```

c. Nhóm sáu $[40,45)$ là nhóm có tần số lớn nhất $n_6=17$. Nhóm này có đầu mút trái $u=40$ và độ dài $g=5$. Nhóm năm liền trước nó có tần số $n_5=10$ và nhóm bảy liền sau nó có tần số $n_7=0$. Mốt là
\begin{align*}
M_o 
    & = u + \left(\frac{n_6-n_5}{2n_6 - n_5 - n_7}\right)\cdot g \\
    & = 40 + \left(\frac{17-10}{2\cdot 17 - 10 - 0}\right)\cdot 5 \\
    & = \frac{995}{24} \\
    & \approx `r formatC(round(as.numeric(bai2$mo), 4), format = "f", digits = 1, decimal.mark = ",")` \text{ (kg).}
\end{align*}

::: {.content-visible when-format="pdf"}
Tóm lại, bảng tần số ghép nhóm là
\begin{center}
\begin{tabular}{|c|c|c|c|c|c|c|c|}
\hline 
$[15;20)$ & $[20; 25)$ & $[25; 30)$ & $[30; 35)$ & $[35;40)$ & $[40; 45)$ & $[45;50)$ & $[50;55)$ \\
\hline 
1 & 0 & 0 & 1 & 10 & 17 & 0 & 1. \\
\hline
\end{tabular}
\end{center}

Các số đặc trưng đo xu thế trung tâm là
\begin{center}
\begin{tabular}{|c|c|c|c|c|}
\hline
$\overline{x}$ & $Q_1$ & $Q_2$ ($M_e$) & $Q_3$ & $M_o$ \\
\hline
`r format(round(as.numeric(bai2$barx), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai2$q1), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai2$me), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai2$q3), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai2$mo), 4), decimal.mark = ",")`. \\
\hline 
\end{tabular}
\end{center}
:::

::: {.ket-thuc}
:::
</details>

<!-- ĐÁP ÁN BÀI TẬP 2 -->
<details>

::: {.content-visible when-format="html"}
<summary class="dap-an">Đáp án</summary>
:::

```{r, echo = FALSE}
data <- rbind(bai2$df[, c(-3, -4), drop = FALSE], c("", "", "", "\\(n=40\\)", ""))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", "TEMP_MARKER", x) # Đổi dấu ',' thành ký hiệu tạm
    x <- gsub("\\.", ",", x) # Đổi dấu '.' thành ','
    gsub("TEMP_MARKER", ";", x) # Đổi ký hiệu tạm thành ';'
})
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = FALSE)
}

```

```{r, echo = FALSE}
# Tạo khung dữ liệu với một hàng duy nhất
data <- data.frame(
    `\\(\\overline{x}\\)` = format(round(as.numeric(bai2$barx), 4), decimal.mark = ","),
    `\\(Q_1\\)` = format(round(as.numeric(bai2$q1), 4), decimal.mark = ","),
    `\\(Q_2\\) (\\(M_e\\))` = format(round(as.numeric(bai2$me), 4), decimal.mark = ","),
    `\\(Q_3\\)` = format(round(as.numeric(bai2$q3), 4), decimal.mark = ","),
    `\\(M_o\\)` = format(round(as.numeric(bai2$mo), 4), decimal.mark = ","),
    check.names = FALSE
)
# Kiểm tra định dạng đầu ra
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
# Hiển thị bảng nếu định dạng đầu ra là HTML
if (output_format == "html") {
    knitr::kable(data, align = "c", format = "html") %>%
        kableExtra::kable_styling(
            bootstrap_options = c("striped", "hover", "condensed", "responsive"),
            full_width = FALSE
        )
}
```

</details>

<!-------------------------------------------------------------------->

<!-- BÀI TẬP 3 -->
<details>

::: {.content-visible when-format="html"}
<summary class="bai-tap">Bài tập 3</summary>
:::

::: {.content-visible when-format="pdf"}
\section*{Bài tập 3}
:::

Bảng 15 cho ta bảng tần số ghép nhóm số liệu thống kê chiều cao của 40 mẫu cây ở một vườn thực vật (đơn vị: cm).

a. Xác định trung bình cộng, trung vị, tứ phân vị của mẫu số liệu ghép nhóm trên.

b. Mốt của mẫu số liệu ghép nhóm trên là bao nhiêu?

<!-- Khung dữ liệu Bài tập 3 -->

```{r}
bai3 <- new.env()
bai3$df <- data.frame(
    ` ` = c(1, 2, 3, 4, 5, 6),
    `Nhóm` = c("\\([30;40)\\)", "\\([40;50)\\)", "\\([50;60)\\)", "\\([60;70)\\)", "\\([70;80)\\)", "\\([80;90)\\)"),
    `Mút trái` = seq(30, 80, by = 10),
    `Mút phải` = seq(40, 90, by = 10),
    `Giá trị đại diện` = .5 * (seq(30, 80, by = 10) + seq(40, 90, by = 10)),
    `Tần số` = c(4, 10, 14, 6, 4, 2),
    `Tần số tích lũy` = c(4, 14, 28, 34, 38, 40),
    check.names = FALSE
)
data <- data.frame(bai3$df[, c(-1, -3, -4, -5), drop = FALSE], check.names = FALSE)
data <- rbind(data, c("", "\\(n=40\\)", ""))
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA, caption = "Bảng 15") %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE)
}
```

</details>

<!-- Lời giải bài tập 3 -->

<details>

::: {.content-visible when-format="html"}
<summary class="loi-giai">Lời giải</summary>
:::

::: {.content-visible when-format="pdf"}
\begin{center}
\textbf{Lời giải}
\end{center}
:::

a. Mình sẽ thêm vào bảng đã cho cột Giá trị đại diện để tính trung bình, và cột số thứ tự để dễ quan sát.

<!-- Bảng tần số mở rộng -->

```{r, echo = FALSE}
data <- rbind(bai3$df[, c(-3, -4), drop = FALSE], c("", "", "", "\\(n=40\\)", ""))
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
} else if (output_format == "latex") {
    kable(data, format = "latex", booktabs = TRUE, align = "c", col.names = NA, escape = FALSE, longtable = TRUE) %>%
        kable_styling(latex_options = c("hold_position", "repeat_header"), full_width = FALSE) 
}
```

<!-- Trung bình -->

```{r, echo = FALSE}
bai3$n <- sum(bai3$df$`Tần số`)
bai3$barx <- fractions((1 / bai3$n) * sum(bai3$df$`Giá trị đại diện` * bai3$df$`Tần số`))
```

- Mẫu có $n=40$ số liệu. Nhóm một có giá trị đại diện $x_1=35$ và tần số $n_1=4$, vân vân cho đến nhóm sáu có giá trị đại diện $x_6=85$ và tần số $n_6=2$. Trung bình là

\begin{align*}
    \overline{x}
        & = \frac{1}{n}(n_1\cdot x_1 + n_2\cdot x_2 + n_3\cdot x_3 + n_4\cdot x_4 + n_5\cdot x_5 + n_6\cdot x_6) \\
        & = \frac{1}{40} (4\cdot 35 + 10\cdot 45 + 14\cdot 55 + 6\cdot 65 + 4\cdot 75 + 2\cdot 85) \\
        & = \frac{111}{2} \\
        & = `r format(round(as.numeric(bai3$barx), 4), decimal.mark = ",")` \text{ (cm).}
\end{align*}

<!-- Trung vị -->

```{r, echo = FALSE}
# Tìm nhóm trung vị
bai3$k <- which(bai3$df$`Tần số tích lũy` >= bai3$n / 2)[1] # Tìm chỉ mục (vị trí hàng) đầu tiên ([1]) trong bai3$df sao cho giá trị của cột "Tần số tích lũy" lớn hơn hoặc bằng bai3$n / 2, rồi lưu vào bai3$k.
# Mút trái nhóm trung vị
bai3$r <- bai3$df$`Mút trái`[bai3$k]
# Độ rộng nhóm
bai3$d <- bai3$df$`Mút phải`[bai3$k] - bai3$df$`Mút trái`[bai3$k]
# Tính trung vị
bai3$me <- fractions(bai3$r + ((bai3$n / 2 - ifelse(bai3$k > 1, bai3$df$`Tần số tích lũy`[bai3$k - 1], 0)) / bai3$df$`Tần số`[bai3$k]) * bai3$d)
```

- Nhóm ba, $[50;55)$, là nhóm đầu tiên có tần số tích lũy $cf_3=28$ không nhỏ hơn $\frac{n}{2}=20$. Nhóm này có đầu mút trái $r=50$, độ dài $d=10$ và tần số $n_3=14$. Nhóm hai liền trước nó có tần số tích lũy $cf_2=14$. Trung vị là

\begin{align*}
M_e
    & = r + \left(\frac{\frac{n}{2}-cf_2}{n_3}\right)\cdot d \\
    & = 50 + \left(\frac{20-14}{14}\right)\cdot 10 \\
    & = \frac{380}{7} \\
    & \approx `r format(round(as.numeric(bai3$me), 4), decimal.mark = ",")` \text{ (cm).}
\end{align*}

<!-- Tứ phân vị thứ nhất Q1 -->

```{r, echo = FALSE}
# Tìm nhóm tứ phân vị thứ nhất
bai3$p <- which(bai3$df$`Tần số tích lũy` >= bai3$n / 4)[1]
# Mút trái nhóm tứ phân vị thứ nhất
bai3$s <- bai3$df$`Mút trái`[bai3$p]
# Độ rộng nhóm tứ phân vị thứ nhất
bai3$h <- bai3$df$`Mút phải`[bai3$p] - bai3$df$`Mút trái`[bai3$p]
# Tính tứ phân vị thứ nhất
bai3$q1 <- fractions(bai3$s + ((bai3$n / 4 - ifelse(bai3$p > 1, bai3$df$`Tần số tích lũy`[bai3$p - 1], 0)) / bai3$df$`Tần số`[bai3$p]) * bai3$h)
```

- Nhóm hai, $[40;50)$, là nhóm đầu tiên có tần số tích lũy $cf_2=14$ không nhỏ hơn $\frac{n}{4}=10$. Nhóm này có đầu mút trái $s=40$, độ dài $h=10$ và tần số $n_2=10$. Nhóm một có tần số tích lũy là $cf_1=4$. Tứ phân vị thứ nhất là

    \begin{align*}
        Q_1
            & = s + \left( \frac{\frac{n}{4}-cf_1}{n_2}\right)\cdot h \\
            & = 40 + \left(\frac{10-4}{10}\right)\cdot 10 \\
            & = `r format(round(as.numeric(bai3$q1), 4), decimal.mark = ",")` \text{ (cm).}
    \end{align*}

- Tứ phân vị thứ hai $Q_2$ chính là trung vị $M_e$, hay $Q_2 = M_e = `r format(round(as.numeric(bai3$me), 4), decimal.mark = ",")`$ (cm).

<!-- Tứ phân vị thứ ba Q3 -->

```{r, echo = FALSE}
# Tìm nhóm tứ phân vị thứ ba
bai3$q <- which(bai3$df$`Tần số tích lũy` >= (3 * bai3$n) / 4)[1]
# Mút trái nhóm tứ phân vị thứ ba
bai3$t <- bai3$df$`Mút trái`[bai3$q]
# Độ rộng nhóm tứ phân vị thứ ba
bai3$l <- bai3$df$`Mút phải`[bai3$q] - bai3$df$`Mút trái`[bai3$q]
# Tính tứ phân vị thứ ba
bai3$q3 <- fractions(bai3$t + (((3 * bai3$n) / 4 - ifelse(bai3$q > 1, bai3$df$`Tần số tích lũy`[bai3$q - 1], 0)) / bai3$df$`Tần số`[bai3$q]) * bai3$h)
```

- Nhóm bốn, $[60;70)$, là nhóm đầu tiên có tần số tích lũy $cf_4=34$ không nhỏ hơn $\frac{3n}{4}=30$. Nhóm này có đầu mút trái $t=60$, độ dài $l=10$ và tần số $n_4=6$. Nhóm thứ ba có tần số tích lũy là $cf_3=28$. Tứ phân vị thứ ba là

    \begin{align*}
        Q_3
            & = t + \left(\frac{\frac{3n}{4}-cf_3}{n_4}\right)\cdot l \\
            & = 60 + \left(\frac{30-28}{6}\right)\cdot 10 \\
            & = \frac{190}{3} \\
            & = `r format(round(as.numeric(bai3$q3), 4), decimal.mark = ",")` \text{ (cm).}
    \end{align*}

<!-- Mốt -->

```{r, echo = FALSE}
# Tìm nhóm có tần số lớn nhất
bai3$i <- which.max(bai3$df$`Tần số`)
# Mút trái của nhóm mốt
bai3$u <- bai3$df$`Mút trái`[bai3$i]
# Độ rộng nhóm mốt
bai3$g <- bai3$df$`Mút phải`[bai3$i] - bai3$df$`Mút trái`[bai3$i]
# Tính mốt
bai3$mo <- fractions(bai3$u + ((bai3$df$`Tần số`[bai3$i] - ifelse(bai3$i > 1, bai3$df$`Tần số`[bai3$i - 1], 0)) / (2 * bai3$df$`Tần số`[bai3$i] - ifelse(bai3$i > 1, bai3$df$`Tần số`[bai3$i - 1]) - ifelse(bai3$i < nrow(bai3$df), bai3$df$`Tần số`[bai3$i + 1], 0))) * bai3$g, 4)
```

b. Nhóm ba, $[50;60)$, là nhóm có tần số lớn nhất $n_3=14$. Nó có đầu mút trái $u=50$ và độ dài $g=10$. Nhóm hai có tần số $n_2=10$ và nhóm bốn có tần số $n_4=6$. Mốt là
    \begin{align*}
        M_o
            & = u + \left(\frac{n_3-n_2}{2n_3-n_2-n_4}\right) \cdot g \\
            & = 50 + \left(\frac{14-10}{2\cdot 14-10-6}\right)\cdot 10 \\
            & = \frac{160}{3} \\
            & \approx `r format(round(as.numeric(bai3$mo), 4), decimal.mark = ",")` \text{ (cm)}.
    \end{align*}

::: {.content-visible when-format="pdf"}
Tóm lại, bảng tần số ghép nhóm là
\begin{center}
\begin{tabular}{|c|c|c|c|c|c|}
\hline 
$[30;40)$ & $[40;50)$ & $[50;60)$ & $[60;70)$ & $[70;80)$ & $[80;90)$  \\
\hline 
1 & 0 & 0 & 1 & 10 & 17. \\
\hline
\end{tabular}
\end{center}

Các số đặc trưng đo xu thế trung tâm là
\begin{center}
\begin{tabular}{|c|c|c|c|c|}
\hline
$\overline{x}$ & $Q_1$ & $Q_2$ ($M_e$) & $Q_3$ & $M_o$ \\
\hline
`r format(round(as.numeric(bai3$barx), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai3$q1), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai3$me), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai3$q3), 4), decimal.mark = ",")` & `r format(round(as.numeric(bai3$mo), 4), decimal.mark = ",")`. \\
\hline 
\end{tabular}
\end{center}
:::

::: {.ket-thuc}
:::
</details>

<!-- Đáp án bài tập 3 -->

<details>

::: {.content-visible when-format="html"}
<summary class="dap-an">Đáp án</summary>
:::

```{r, echo = FALSE}
data <- rbind(bai3$df[, c(-3, -4), drop = FALSE], c("", "", "", "\\(n=40\\)", ""))
data[] <- lapply(data, function(x) {
    x <- as.character(x) # Đảm bảo x là kiểu character
    x <- gsub(",", "TEMP_MARKER", x) # Đổi dấu ',' thành ký hiệu tạm
    x <- gsub("\\.", ",", x) # Đổi dấu '.' thành ','
    gsub("TEMP_MARKER", ";", x) # Đổi ký hiệu tạm thành ';'
})
# Chọn định dạng dựa vào output
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (output_format == "html") {
    kable(data, format = "html", align = "c", col.names = NA) %>%
        kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = FALSE)
}

```

```{r, echo = FALSE}
# Tạo khung dữ liệu với một hàng duy nhất
data <- data.frame(
    `\\(\\overline{x}\\)` = format(round(as.numeric(bai3$barx), 4), decimal.mark = ","),
    `\\(Q_1\\)` = format(round(as.numeric(bai3$q1), 4), decimal.mark = ","),
    `\\(Q_2\\) (\\(M_e\\))` = format(round(as.numeric(bai3$me), 4), decimal.mark = ","),
    `\\(Q_3\\)` = format(round(as.numeric(bai3$q3), 4), decimal.mark = ","),
    `\\(M_o\\)` = format(round(as.numeric(bai3$mo), 4), decimal.mark = ","),
    check.names = FALSE
)
# Kiểm tra định dạng đầu ra
output_format <- knitr::opts_knit$get("rmarkdown.pandoc.to")
# Hiển thị bảng nếu định dạng đầu ra là HTML
if (output_format == "html") {
    knitr::kable(data, align = "c", format = "html") %>%
        kableExtra::kable_styling(
            bootstrap_options = c("striped", "hover", "condensed", "responsive"),
            full_width = FALSE
        )
}
```

</details>


<!-- STORE -->

<!--
<button class="bai-tap" onclick="toggleContent()">
Bài tập 1
</button>

<div class="bai-tap-content" id="hiddenContent" >
<p>Đây là nội dung bài tập.</p>
$$n=2$$
</div>

<script>
function toggleContent() {
var content = document.getElementById("hiddenContent");
content.style.display = (content.style.display === "none") ? "block" : "none";
}
</script>
-->